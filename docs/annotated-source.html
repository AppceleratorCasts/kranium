<html>
	<head>
		<title>Kranium</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>Kranium</h1><p>This is the annotated source of the Kranium library</p></td><td></td></tr><tr class="filename"><td><h2 id="lib/kranium-src/core.js"><a href="#">core</a></h2></td><td>lib/kranium-src/core.js</td></tr><tr class="code">
<td class="docs">
<p>Define core module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){

<span class="variable">global</span>.<span class="class">GLOBAL</span> = <span class="variable">global</span>;
<span class="variable">win</span> = <span class="variable">global</span>.<span class="variable">win</span>||<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">currentWindow</span>||{};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Cache RegExps
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">reTiObject</span> = <span class="regexp">/^\[object Ti/</span>,
<span class="variable">reJadeStr</span> = <span class="regexp">/(\.jade$|^\s*<)/</span>,</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inline utility functions
 </p>
</td>
<td class="code">
<pre><code><span class="class">ArrayProp</span> = <span class="class">Array</span>.<span class="variable">prototype</span>,
<span class="variable">slice</span> = <span class="class">ArrayProp</span>.<span class="variable">slice</span>, 
<span class="variable">toString</span> = <span class="class">Object</span>.<span class="variable">prototype</span>.<span class="variable">toString</span>,
<span class="variable">noop</span> = <span class="keyword">function</span>(){};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Create class-checking function</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name className</p></li><li><p><strong>returns</strong>: <em>Function</em>  Function testing if arg has class</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">classRE</span>(<span class="variable">name</span>){ <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">RegExp</span>(<span class="string">"(^|\\s)"</span> + <span class="variable">name</span> + <span class="string">"(\\s|$)"</span>); }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Filter falsy values from array</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  array</p></li><li><p><strong>returns</strong>: <em>Array</em>  clone of array with falsy values filtered out</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">compact</span>(<span class="variable">array</span>){ <span class="keyword">return</span> <span class="variable">array</span>.<span class="variable">filter</span>(<span class="keyword">function</span>(<span class="variable">item</span>){ <span class="keyword">return</span> <span class="variable">item</span> !== <span class="variable">undefined</span> && <span class="variable">item</span> !== <span class="keyword">null</span>; }); }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Flatten array of arrays</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  array</p></li><li><p><strong>returns</strong>: <em>Array</em>  Shallow clone of array</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">flatten</span>(<span class="variable">array</span>){ <span class="keyword">return</span> <span class="variable">array</span>.<span class="variable">reduce</span>(<span class="keyword">function</span>(<span class="variable">a</span>,<span class="variable">b</span>){ <span class="keyword">return</span> <span class="variable">a</span>.<span class="variable">concat</span>(<span class="variable">b</span>); }, []); }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Camel-case dash-separated string</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>returns</strong>: <em>String</em>  Camel-cased input str</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">camelize</span>(<span class="variable">str</span>){ <span class="keyword">return</span> <span class="variable">str</span>.<span class="variable">replace</span>(<span class="regexp">/-+(.)?/g</span>, <span class="keyword">function</span>(<span class="variable">match</span>, <span class="variable">chr</span>){ <span class="keyword">return</span> <span class="variable">chr</span> ? <span class="variable">chr</span>.<span class="variable">toUpperCase</span>() : <span class="string">''</span>; }); }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Arrayify input</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  o</p></li><li><p><strong>returns</strong>: <em>Array</em>  If input was array, return it, otherwise wrap input in new array</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">arrayify</span>(<span class="variable">o</span>){ <span class="keyword">return</span> <span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">o</span>) ? <span class="variable">o</span> : [<span class="variable">o</span>]; }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Kranium object constructory-thingy</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  dom</p></li><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="class">Z</span>(<span class="variable">dom</span>, <span class="variable">selector</span>) {
    <span class="variable">dom</span> = <span class="variable">dom</span>||[];
    <span class="variable">dom</span>.<span class="variable">__proto__</span> = <span class="class">Z</span>.<span class="variable">prototype</span>;
    <span class="variable">dom</span>.<span class="variable">selector</span> = <span class="variable">selector</span>||<span class="string">''</span>;
    <span class="keyword">return</span> <span class="variable">dom</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Kranium object creator</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | Array | TiObject | Object</em>  dom</p></li><li><p><strong>param</strong>: <em>String | Array | TiObject | Object</em>  context</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> $ = <span class="keyword">function</span>(<span class="variable">selector</span>, <span class="variable">context</span>){
    <span class="keyword">if</span> (<span class="variable">context</span> !== <span class="variable">undefined</span>) <span class="keyword">return</span> $(<span class="variable">context</span>).<span class="variable">find</span>(<span class="variable">selector</span>);
    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">selector</span> <span class="variable">instanceof</span> <span class="class">Z</span>) <span class="keyword">return</span> <span class="variable">selector</span>;
    <span class="keyword">else</span> {
        <span class="keyword">var</span> <span class="variable">dom</span>, <span class="variable">tmp</span>;
        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">selector</span> === <span class="string">'undefined'</span> || <span class="variable">selector</span> === <span class="keyword">null</span> || <span class="variable">selector</span> === <span class="string">'#'</span> || <span class="variable">selector</span> === <span class="string">''</span>) <span class="variable">dom</span> = [];
        <span class="comment">//else if (typeof selector === 'string' && /\.jade/)</span>
        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">selector</span>)){ <span class="variable">dom</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">selector</span>); }
        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">selector</span> && <span class="variable">selector</span>.<span class="variable">toString</span> && <span class="variable">reTiObject</span>.<span class="variable">test</span>(<span class="variable">selector</span>.<span class="variable">toString</span>())) <span class="variable">dom</span> = [<span class="variable">selector</span>];
        <span class="keyword">else</span> <span class="keyword">if</span> (
            <span class="variable">toString</span>.<span class="variable">call</span>(<span class="variable">selector</span>) == <span class="string">'[object Object]'</span> || 
            (<span class="keyword">typeof</span> <span class="variable">selector</span> === <span class="string">'string'</span> && <span class="variable">reJadeStr</span>.<span class="variable">test</span>(<span class="variable">selector</span>) )
        ) <span class="variable">dom</span> = [<span class="class">K</span>.<span class="variable">create</span>(<span class="variable">selector</span>)];
        <span class="keyword">else</span> <span class="variable">dom</span> = <span class="class">Array</span>.<span class="variable">isArray</span>((<span class="variable">tmp</span> = $$(<span class="variable">selector</span>, <span class="keyword">null</span>))) ? <span class="variable">tmp</span> : [<span class="variable">tmp</span>];			
        <span class="keyword">return</span> <span class="class">Z</span>(<span class="variable">dom</span>, <span class="variable">selector</span>);
    }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Utility methods
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">block</span>;
$.<span class="variable">fn</span> = {
    <span class="variable">forEach</span>: <span class="class">ArrayProp</span>.<span class="variable">forEach</span>,
    <span class="variable">map</span>: <span class="class">ArrayProp</span>.<span class="variable">map</span>,
    <span class="variable">reduce</span>: <span class="class">ArrayProp</span>.<span class="variable">reduce</span>,
    <span class="variable">push</span>: <span class="class">ArrayProp</span>.<span class="variable">push</span>,
    <span class="variable">indexOf</span>: <span class="class">ArrayProp</span>.<span class="variable">indexOf</span>,
    <span class="variable">concat</span>: <span class="class">ArrayProp</span>.<span class="variable">concat</span>,</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get plain array from Kranium collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  [idx] Return only element at index</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">get</span>: <span class="keyword">function</span>(<span class="variable">idx</span>){ 
        <span class="keyword">return</span> <span class="variable">idx</span> === <span class="variable">undefined</span> ? 
            <span class="variable">slice</span>.<span class="variable">call</span>(<span class="this">this</span>) : 
            (<span class="variable">idx</span> < <span class="number integer">0</span> ? <span class="this">this</span>[<span class="this">this</span>.<span class="variable">length</span> + <span class="variable">idx</span>] : <span class="this">this</span>[<span class="variable">idx</span>]); 
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set properties on all elements in Kranium collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | Object</em>  [prop] Prop to set value to, or Object containg key-value-pairs</p></li><li><p><strong>param</strong>: <em>String</em>  [val] Value to set prop to</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">set</span>: <span class="keyword">function</span>(<span class="variable">prop</span>, <span class="variable">val</span>){
        <span class="keyword">var</span> <span class="variable">props</span> = (<span class="keyword">typeof</span> <span class="variable">prop</span> === <span class="string">'string'</span>) ? 
                [{ <span class="variable">key</span>: <span class="variable">prop</span>, <span class="variable">val</span>: <span class="variable">val</span> }] : 
                <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">prop</span>).<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">key</span>){ 
                    <span class="keyword">return</span> { <span class="variable">key</span>: <span class="variable">key</span>, <span class="variable">val</span>: <span class="variable">prop</span>[<span class="variable">key</span>] }; 	
                }),
                
            <span class="variable">i</span>, <span class="variable">o</span>;
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
            <span class="variable">i</span> = <span class="variable">props</span>.<span class="variable">length</span>;
            <span class="keyword">while</span>((<span class="variable">o</span> = <span class="variable">props</span>[--<span class="variable">i</span>])){
                <span class="this">this</span>[<span class="variable">o</span>.<span class="variable">key</span>] = <span class="variable">o</span>.<span class="variable">val</span>;
            }
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Select part of collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  start Starting position</p></li><li><p><strong>param</strong>: <em>Integer</em>  end Ending position</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">slice</span>: <span class="keyword">function</span>(<span class="variable">start</span>, <span class="variable">end</span>){			
        <span class="keyword">return</span> <span class="class">K</span>(<span class="variable">slice</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">start</span>, <span class="variable">end</span> === <span class="number integer">0</span> ? <span class="variable">undefined</span> : <span class="variable">end</span>));
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Turn Kranium collection into plain Array</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Array</em> </p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">toArray</span>: <span class="keyword">function</span>(){ <span class="keyword">return</span> <span class="variable">slice</span>.<span class="variable">call</span>(<span class="this">this</span>); },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get number of elements in collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Integer</em> </p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">size</span>: <span class="keyword">function</span>(){ <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">length</span>; },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Remove the elements in the collection from their respective parents</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">remove</span>: <span class="keyword">function</span>(){

        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(
            <span class="keyword">function</span>(){
                <span class="keyword">var</span> <span class="variable">el</span> = <span class="this">this</span>, <span class="variable">index</span>, <span class="variable">arr</span>;
            
                (<span class="variable">el</span>.<span class="variable">className</span>||<span class="string">""</span>).<span class="variable">split</span>(<span class="regexp">/\s+/</span>).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">cls</span>){
                    <span class="keyword">if</span>(<span class="variable">cls</span> && (<span class="variable">index</span> = <span class="class">K</span>.<span class="variable">elsByClassName</span>[<span class="variable">cls</span>].<span class="variable">indexOf</span>(<span class="variable">el</span>)) != -<span class="number integer">1</span>){
                        <span class="class">K</span>.<span class="variable">elsByClassName</span>[<span class="variable">cls</span>].<span class="variable">splice</span>(<span class="variable">index</span>, <span class="number integer">1</span>); 
                    }
                });

                <span class="keyword">if</span>((<span class="variable">arr</span> = <span class="class">K</span>.<span class="variable">elsByName</span>[<span class="variable">el</span>.<span class="variable">_type</span>]) && ((<span class="variable">index</span> = <span class="variable">arr</span>.<span class="variable">indexOf</span>(<span class="variable">el</span>)) != -<span class="number integer">1</span>)){
                    <span class="class">K</span>.<span class="variable">elsByName</span>[<span class="variable">el</span>.<span class="variable">_type</span>].<span class="variable">splice</span>(<span class="variable">index</span>, <span class="number integer">1</span>);
                }
                <span class="keyword">if</span>(<span class="variable">el</span>.<span class="variable">_id</span> && <span class="class">K</span>.<span class="variable">elsById</span>[<span class="variable">el</span>.<span class="variable">_id</span>]){
                    <span class="keyword">delete</span> <span class="class">K</span>.<span class="variable">elsById</span>[<span class="variable">el</span>.<span class="variable">_id</span>];
                }
                <span class="keyword">try</span> { <span class="variable">el</span>.<span class="variable">getParent</span>().<span class="variable">remove</span>(<span class="variable">el</span>); } <span class="keyword">catch</span>(<span class="variable">e</span>){ <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">e</span>); }
            }
        ); 
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Iterate collection using iterator</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  callback</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">each</span>: <span class="keyword">function</span>(<span class="variable">callback</span>){
        <span class="this">this</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">el</span>, <span class="variable">idx</span>){ <span class="variable">callback</span>.<span class="variable">call</span>(<span class="variable">el</span>, <span class="variable">idx</span>, <span class="variable">el</span>); });
        <span class="keyword">return</span> <span class="this">this</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Filter collection using selector</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">filter</span>: <span class="keyword">function</span>(<span class="variable">selector</span>){
        <span class="keyword">return</span> $(<span class="class">ArrayProp</span>.<span class="variable">filter</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="keyword">function</span>(<span class="variable">element</span>){
            <span class="keyword">return</span> $$(<span class="variable">selector</span>, <span class="variable">element</span>.<span class="variable">getParent</span>()).<span class="variable">indexOf</span>(<span class="variable">element</span>) >= <span class="number integer">0</span>;
        }));
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Test if first element in collection matches selector</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">is</span>: <span class="keyword">function</span>(<span class="variable">selector</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">length</span> > <span class="number integer">0</span> && $(<span class="this">this</span>[<span class="number integer">0</span>]).<span class="variable">filter</span>(<span class="variable">selector</span>).<span class="variable">length</span> > <span class="number integer">0</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Pick element from collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  idx</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">eq</span>: <span class="keyword">function</span>(<span class="variable">idx</span>){ <span class="variable">idx</span> = <span class="variable">parseInt</span>(<span class="variable">idx</span>, <span class="number integer">10</span>); <span class="keyword">return</span> $(<span class="this">this</span>).<span class="variable">slice</span>(<span class="variable">idx</span>, <span class="variable">idx</span> + <span class="number integer">1</span>); },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Add stuff to a clone of the current collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array | TiObject | KraniumCollection</em>  els</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">add</span>: <span class="keyword">function</span>(<span class="variable">els</span>){
        <span class="keyword">return</span> $(<span class="this">this</span>.<span class="variable">concat</span>(<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">els</span>) ? <span class="variable">els</span> : [<span class="variable">els</span>]));
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get first element in collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">first</span>: <span class="keyword">function</span>(){ <span class="keyword">return</span> $(<span class="this">this</span>[<span class="number integer">0</span>]); },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get last element in collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">last</span>: <span class="keyword">function</span>(){ <span class="keyword">return</span> $(<span class="this">this</span>[<span class="this">this</span>.<span class="variable">length</span> - <span class="number integer">1</span>]); },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Search first element for elements matching selector</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">find</span>: <span class="keyword">function</span>(<span class="variable">selector</span>){
        <span class="keyword">var</span> <span class="variable">result</span>;
        <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">length</span> == <span class="number integer">1</span>) <span class="variable">result</span> = $$(<span class="variable">selector</span>, <span class="this">this</span>[<span class="number integer">0</span>]);
        <span class="keyword">else</span> <span class="variable">result</span> = <span class="variable">flatten</span>(<span class="this">this</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">el</span>){ <span class="keyword">return</span> $$(<span class="variable">selector</span>, <span class="variable">el</span>); }));
        <span class="keyword">return</span> $(<span class="variable">result</span>);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Find the first ancestor matching the selector</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>param</strong>: <em>String | TiObject</em>  context</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">closest</span>: <span class="keyword">function</span>(<span class="variable">selector</span>, <span class="variable">context</span>){
        <span class="keyword">var</span> <span class="variable">node</span> = <span class="this">this</span>[<span class="number integer">0</span>],
            <span class="variable">nodes</span> = $$(<span class="variable">selector</span>, <span class="variable">context</span>); <span class="comment">//context !== undefined ? context : document);</span>
        
        <span class="keyword">if</span> (<span class="variable">nodes</span>.<span class="variable">length</span> === <span class="number integer">0</span>) <span class="variable">node</span> = <span class="keyword">null</span>;
        <span class="keyword">while</span> (<span class="variable">node</span> && <span class="variable">nodes</span>.<span class="variable">indexOf</span>(<span class="variable">node</span>) < <span class="number integer">0</span>) { <span class="variable">node</span> = <span class="variable">node</span>.<span class="variable">getParent</span>(); };
        <span class="keyword">return</span> $(<span class="variable">node</span>);

    },
    <span class="variable">parents</span>: <span class="keyword">function</span>(){}, <span class="comment">//TODO: implement me</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>For all elements in the collection, return their parent, optionally only if it matches the selector</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">parent</span>: <span class="keyword">function</span>(<span class="variable">selector</span>){
        <span class="keyword">var</span> <span class="variable">node</span>, <span class="variable">nodes</span> = [];
        <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
            <span class="keyword">if</span> ((<span class="variable">node</span> = <span class="this">this</span>.<span class="variable">getParent</span>()) && <span class="variable">nodes</span>.<span class="variable">indexOf</span>(<span class="variable">node</span>) < <span class="number integer">0</span>) <span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">node</span>);
        });
        <span class="variable">nodes</span> = $(<span class="variable">nodes</span>);
        <span class="keyword">return</span> <span class="variable">selector</span> === <span class="variable">undefined</span> ? <span class="variable">nodes</span> : <span class="variable">nodes</span>.<span class="variable">filter</span>(<span class="variable">selector</span>);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>For all elements in the collection, return their children, optionally only if it matches the selector</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  selector</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">children</span>: <span class="keyword">function</span>(<span class="variable">selector</span>){
        <span class="keyword">var</span> <span class="variable">children</span>, <span class="variable">nodes</span> = [];
        <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
            (<span class="this">this</span>.<span class="variable">children</span>||[]).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">child</span>){	
                <span class="variable">child</span> && (<span class="variable">nodes</span>.<span class="variable">indexOf</span>(<span class="variable">child</span>) < <span class="number integer">0</span>) && <span class="variable">nodes</span>.<span class="variable">push</span>(<span class="variable">child</span>);
            });
        });
        <span class="variable">nodes</span> = $(<span class="variable">nodes</span>);
        <span class="keyword">return</span> <span class="variable">selector</span> === <span class="variable">undefined</span> ? <span class="variable">nodes</span> : <span class="variable">nodes</span>.<span class="variable">filter</span>(<span class="variable">selector</span>);
    },
    
    <span class="variable">siblings</span>: <span class="keyword">function</span>(){}, <span class="comment">//TODO: implement me</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Pluck property from elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  property</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">pluck</span>: <span class="keyword">function</span>(<span class="variable">property</span>){ <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">element</span>){ <span class="keyword">return</span> <span class="variable">element</span>[<span class="variable">property</span>]; }); },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Show elements in collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">show</span>: <span class="keyword">function</span>(<span class="variable">o</span>){ <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){ <span class="this">this</span>.<span class="variable">show</span>(<span class="variable">o</span>); }); },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Hide elements in collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">hide</span>: <span class="keyword">function</span>(){ <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){ <span class="this">this</span>.<span class="variable">hide</span>(); }); },
    
    
    <span class="variable">prev</span>: <span class="keyword">function</span>(){}, <span class="comment">//TODO: implement me</span>
    <span class="variable">next</span>: <span class="keyword">function</span>(){}, <span class="comment">//TODO: implement me</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get value of first element or set value of all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Any</em>  [val] If specified, set value of all elements, otherwise return current value of first element</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">val</span>: <span class="keyword">function</span>(<span class="variable">val</span>){
        <span class="keyword">return</span> <span class="variable">val</span> === <span class="variable">undefined</span> ? (<span class="this">this</span>.<span class="variable">length</span> > <span class="number integer">0</span> ? <span class="this">this</span>[<span class="number integer">0</span>].<span class="variable">value</span> : <span class="keyword">null</span>) : <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>() {
            <span class="this">this</span>.<span class="variable">value</span> = <span class="variable">val</span>;
        });
    },
    
    <span class="variable">offset</span>: <span class="keyword">function</span>(){}, <span class="comment">//TODO: implement me</span></code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get css property of first element or set css property of all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | Object</em>  property Property to get or set value for, or hash map to set</p></li><li><p><strong>param</strong>: <em>String | Integer</em>  [value] If specified, set css of elements, otherwise return current value of first element</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">css</span>: <span class="keyword">function</span>(<span class="variable">property</span>, <span class="variable">value</span>) {
        <span class="keyword">if</span> (<span class="variable">value</span> === <span class="variable">undefined</span> && <span class="keyword">typeof</span> <span class="variable">property</span> == <span class="string">'string'</span>) <span class="keyword">return</span> <span class="this">this</span>[<span class="number integer">0</span>] && <span class="this">this</span>[<span class="number integer">0</span>][<span class="variable">camelize</span>(<span class="variable">property</span>)];
        <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">property</span> == <span class="string">'string'</span> && <span class="keyword">typeof</span> <span class="variable">value</span> != <span class="string">'undefined'</span>){
            <span class="keyword">var</span> <span class="variable">p</span> = <span class="variable">property</span>;
            <span class="variable">property</span> = {};
            <span class="variable">property</span>[<span class="variable">camelize</span>(<span class="variable">p</span>)] = <span class="variable">value</span>;
        }
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>() {
            <span class="keyword">for</span> (<span class="variable">key</span> <span class="keyword">in</span> <span class="variable">property</span>){
                <span class="this">this</span>[<span class="variable">key</span>] = <span class="variable">property</span>[<span class="variable">key</span>];
            }
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get index of element in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>TiObject</em>  element</p></li><li><p><strong>returns</strong>: <em>Integer</em>  Position in collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">index</span>: <span class="keyword">function</span>(<span class="variable">element</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">indexOf</span>($(<span class="variable">element</span>)[<span class="number integer">0</span>]);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Test if first element in collection has the specified class</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>returns</strong>: <em>Boolean</em> </p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">hasClass</span>: <span class="keyword">function</span>(<span class="variable">name</span>){
        <span class="keyword">return</span> <span class="variable">classRE</span>(<span class="variable">name</span>).<span class="variable">test</span>(<span class="this">this</span>[<span class="number integer">0</span>].<span class="variable">className</span>);
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Add class to all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>returns</strong>: <em>Boolean</em> </p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">addClass</span>: <span class="keyword">function</span>(<span class="variable">name</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
            !$(<span class="this">this</span>).<span class="variable">hasClass</span>(<span class="variable">name</span>) && (<span class="this">this</span>.<span class="variable">className</span> += (<span class="this">this</span>.<span class="variable">className</span> ? <span class="string">' '</span> : <span class="string">''</span>) + <span class="variable">name</span>);
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Rmove class from all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>returns</strong>: <em>Boolean</em> </p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">removeClass</span>: <span class="keyword">function</span>(<span class="variable">name</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
            <span class="this">this</span>.<span class="variable">className</span> = <span class="this">this</span>.<span class="variable">className</span>.<span class="variable">replace</span>(<span class="variable">classRE</span>(<span class="variable">name</span>), <span class="string">' '</span>).<span class="variable">trim</span>();
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Toggle class for all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Boolean</em>  [when]</p></li><li><p><strong>returns</strong>: <em>Boolean</em> </p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">toggleClass</span>: <span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">when</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
         	((<span class="variable">when</span> !== <span class="variable">undefined</span> && !<span class="variable">when</span>) || $(<span class="this">this</span>).<span class="variable">hasClass</span>(<span class="variable">name</span>)) ?
         	$(<span class="this">this</span>).<span class="variable">removeClass</span>(<span class="variable">name</span>) : $(<span class="this">this</span>).<span class="variable">addClass</span>(<span class="variable">name</span>);
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Append elements to first element in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array | TiObject</em>  els</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">append</span>: <span class="keyword">function</span>(<span class="variable">els</span>){
        <span class="keyword">var</span> <span class="variable">parent</span> = <span class="this">this</span>[<span class="number integer">0</span>],
            <span class="variable">els</span> = <span class="variable">arrayify</span>(<span class="variable">els</span>);
        <span class="keyword">switch</span>(<span class="variable">parent</span>){
            <span class="keyword">default</span>:
                <span class="variable">els</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">el</span>){
                    <span class="variable">el</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">el</span>);
                    <span class="variable">parent</span>.<span class="variable">add</span>(<span class="variable">el</span>); 	
                });
                <span class="keyword">break</span>;
        }
        <span class="keyword">return</span> <span class="this">this</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Append all elements to specified parent</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array | TiObject | Collection</em>  parent</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">appendTo</span>: <span class="keyword">function</span>(<span class="variable">parent</span>){
        <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">parent</span> === <span class="string">'string'</span>){
            <span class="variable">parent</span> = <span class="class">K</span>(<span class="variable">parent</span>).<span class="variable">get</span>(<span class="number integer">0</span>);
        }
        <span class="keyword">switch</span>(<span class="variable">parent</span>&&<span class="variable">parent</span>.<span class="variable">_type</span>){
            <span class="keyword">case</span> <span class="string">'mapview'</span>:
                <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
                    <span class="variable">parent</span>.<span class="variable">addAnnotation</span>(<span class="this">this</span>);
                });
                <span class="keyword">break</span>;
                
            <span class="keyword">default</span>:
                <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
                    <span class="variable">parent</span>.<span class="variable">add</span>(<span class="this">this</span>);
                });
                <span class="keyword">break</span>;
        }
        <span class="keyword">return</span> <span class="this">this</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Bind namd event listener to all elements in collection with optional context</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>param</strong>: <em>Any</em>  ctx</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">bind</span>: <span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">fn</span>, <span class="variable">ctx</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(){
            <span class="keyword">var</span> <span class="variable">el</span> = <span class="this">this</span>,
                <span class="variable">events</span> = (<span class="variable">el</span>.<span class="variable">_events</span> = <span class="variable">el</span>.<span class="variable">_events</span>||{}),
                <span class="variable">boundFn</span> = <span class="variable">fn</span>.<span class="variable">bind</span>(<span class="variable">ctx</span> || <span class="variable">el</span>);
                
            (<span class="variable">events</span>[<span class="variable">name</span>] = <span class="variable">events</span>[<span class="variable">name</span>]||[]).<span class="variable">push</span>(<span class="variable">boundFn</span>);
            
            <span class="variable">el</span>.<span class="variable">addEventListener</span>(<span class="variable">name</span>, <span class="variable">boundFn</span>);
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Unbind namd event listener from all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">unbind</span>: <span class="keyword">function</span>(<span class="variable">name</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(<span class="variable">el</span>){
            <span class="keyword">var</span> <span class="variable">toUnbind</span> = [], <span class="variable">fns</span>;
            <span class="keyword">if</span>(<span class="variable">name</span> && <span class="variable">el</span>.<span class="variable">_events</span> && (<span class="variable">fns</span> = <span class="variable">el</span>.<span class="variable">_events</span>[<span class="variable">name</span>])){
                <span class="variable">toUnbind</span> = <span class="variable">fns</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">fn</span>){ <span class="keyword">return</span> { <span class="variable">name</span>: <span class="variable">name</span>, <span class="variable">fn</span>: <span class="variable">fn</span> }; });
            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">el</span>.<span class="variable">_events</span>){
                <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">el</span>.<span class="variable">_events</span>).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">name</span>) {
                    (<span class="variable">el</span>.<span class="variable">_events</span>[<span class="variable">name</span>]).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">fn</span>) {
                        <span class="variable">toUnbind</span>.<span class="variable">push</span>({
                            <span class="variable">name</span>: <span class="variable">name</span>,
                            <span class="variable">fn</span>: <span class="variable">fn</span>
                        });
                    });
                });
            }
            <span class="variable">toUnbind</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">o</span>){
                <span class="variable">el</span>.<span class="variable">removeEventListener</span>(<span class="variable">o</span>.<span class="variable">name</span>, <span class="variable">o</span>.<span class="variable">fn</span>);	
            });
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Open first element in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>TiObject</em>  parent</p></li><li><p><strong>param</strong>: <em>Object</em>  o Options object to pass to open fn</p></li><li><p><strong>param</strong>: <em>Any</em>  ctx</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">open</span>: <span class="keyword">function</span>(<span class="variable">parent</span>, <span class="variable">o</span>){
        <span class="keyword">var</span> <span class="variable">el</span> = <span class="this">this</span>[<span class="number integer">0</span>];
        <span class="keyword">if</span>(<span class="variable">el</span>){
            <span class="keyword">switch</span>(<span class="variable">el</span>.<span class="variable">_type</span>){
                <span class="keyword">case</span> <span class="string">'window'</span>:
                    <span class="keyword">if</span>(<span class="variable">parent</span> == <span class="string">'tab'</span>){
                        <span class="keyword">if</span>(<span class="variable">block</span>){ <span class="keyword">return</span>; } <span class="keyword">else</span> { <span class="variable">block</span> = <span class="variable">true</span>; }
                        
                        <span class="variable">el</span>.<span class="variable">addEventListener</span>(<span class="string">'open'</span>, <span class="keyword">function</span>(){ <span class="variable">block</span> = <span class="variable">false</span>; });
                        <span class="class">K</span>.<span class="variable">currentWindow</span> = <span class="variable">el</span>;
                        
                        <span class="keyword">var</span> <span class="variable">tab</span> = (
                            (<span class="variable">tmp</span> = ((<span class="variable">o</span>&&<span class="variable">o</span>.<span class="variable">tab</span>)||<span class="variable">o</span>)) &&
                            (<span class="keyword">typeof</span> <span class="variable">tmp</span> === <span class="string">'string'</span>) ? $$(<span class="variable">tmp</span>)[<span class="number integer">0</span>] : <span class="variable">tmp</span>
                        ) || (
                            (<span class="variable">tmp</span> = $$(<span class="string">'tabgroup'</span>)) && <span class="variable">tmp</span>[<span class="number integer">0</span>] && <span class="variable">tmp</span>[<span class="number integer">0</span>].<span class="variable">activeTab</span>
                        );
                        
                        (<span class="variable">tab</span>||<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">currentTab</span>).<span class="variable">open</span>(<span class="variable">el</span>, <span class="variable">o</span>||{});
                    } <span class="keyword">else</span> <span class="keyword">if</span>(
                            <span class="variable">parent</span> && 
                            (<span class="variable">parent</span> && <span class="variable">parent</span>.<span class="variable">_type</span> ? <span class="variable">parent</span> : (<span class="variable">parent</span> = $$(<span class="variable">parent</span>)[<span class="number integer">0</span>])) && 
                            [<span class="string">'navigationgroup'</span>, <span class="string">'tabgroup'</span>].<span class="variable">indexOf</span>(<span class="variable">parent</span>.<span class="variable">_type</span>) !== -<span class="number integer">1</span>
                        ) {
                        <span class="variable">parent</span>.<span class="variable">open</span>(<span class="variable">el</span>, <span class="variable">o</span>||{});
                    } <span class="keyword">else</span> {
                        <span class="variable">el</span>.<span class="variable">open</span>();
                    }
                    <span class="keyword">break</span>;
                    
                <span class="keyword">default</span>:
                    <span class="variable">el</span>.<span class="variable">open</span> && <span class="variable">el</span>.<span class="variable">open</span>(<span class="variable">parent</span> && <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">parent</span>, { <span class="variable">type</span>: <span class="string">'window'</span> }), <span class="variable">o</span>);
                    <span class="keyword">break</span>;
            }
        }
        <span class="keyword">return</span> <span class="this">this</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Close first element in collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">close</span>: <span class="keyword">function</span>(){
        <span class="keyword">var</span> <span class="variable">el</span> = <span class="this">this</span>[<span class="number integer">0</span>];
        <span class="variable">el</span> && <span class="variable">el</span>.<span class="variable">close</span> && <span class="variable">el</span>.<span class="variable">close</span>();
        <span class="keyword">return</span> <span class="this">this</span>;
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Get text of first element or set text of all elements in collection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  [text] If specified, set text of elements, otherwise return current text of first element</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">text</span>: <span class="keyword">function</span>(<span class="variable">text</span>) {
        <span class="keyword">return</span> <span class="variable">text</span> === <span class="variable">undefined</span> ? (<span class="this">this</span>.<span class="variable">length</span> > <span class="number integer">0</span> ? (<span class="this">this</span>[<span class="number integer">0</span>].<span class="variable">text</span>||<span class="this">this</span>[<span class="number integer">0</span>].<span class="variable">title</span>) : <span class="keyword">null</span>) : <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>() {
            <span class="this">this</span>.<span class="variable">text</span> = <span class="this">this</span>.<span class="variable">title</span> = <span class="variable">text</span>;
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Animate every element in the collection with the specified options and callback</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  opts</p></li><li><p><strong>param</strong>: <em>Function</em>  [cb]</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">animate</span>: <span class="keyword">function</span>(<span class="variable">opts</span>, <span class="variable">cb</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(<span class="variable">i</span>){
            <span class="this">this</span>.<span class="variable">animate</span>(<span class="variable">opts</span>, (<span class="variable">i</span> == <span class="number integer">0</span> ? <span class="variable">cb</span>||<span class="variable">noop</span> : <span class="variable">noop</span>));
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Trigger the passed event for every element in the collection with optional options object</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  event</p></li><li><p><strong>param</strong>: <em>Object</em>  [obj]</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">trigger</span>: <span class="keyword">function</span>(<span class="variable">event</span>, <span class="variable">obj</span>){
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(<span class="variable">i</span>){
            <span class="this">this</span>.<span class="variable">fireEvent</span>(<span class="variable">event</span>, <span class="variable">obj</span>);
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Replace every element in collection with passed el</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>TiObject | Object</em>  el</p></li><li><p><strong>returns</strong>: <em>Z</em>  Kranium collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">replaceWith</span>: <span class="keyword">function</span>(<span class="variable">el</span>){
        <span class="keyword">var</span> $<span class="variable">parent</span>;
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">each</span>(<span class="keyword">function</span>(<span class="variable">i</span>){
            <span class="class">K</span>(<span class="this">this</span>).<span class="variable">children</span>().<span class="variable">remove</span>();
            <span class="this">this</span>.<span class="variable">add</span>(<span class="class">K</span>.<span class="variable">create</span>(<span class="variable">el</span>));
        });
    },</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return stringified representation of collection</p>

<h2></h2>

<ul><li><p><strong>returns</strong>: <em>String</em>  Stringified representation of collection</p><p> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">stringify</span>: <span class="keyword">function</span>(){
        <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">stringify</span>(<span class="this">this</span>);
    }

};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Iterator</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array | Collection</em>  obj</p></li><li><p><strong>param</strong>: <em>Function</em>  iterator</p></li></ul>
</td>
<td class="code">
<pre><code>$.<span class="variable">each</span> = <span class="keyword">function</span>(<span class="variable">obj</span>, <span class="variable">iterator</span>){
    (<span class="variable">obj</span>||[]).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">el</span>){
        <span class="variable">iterator</span>.<span class="variable">call</span>(<span class="variable">el</span>, <span class="variable">el</span>);
    });
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set utility methods to Z prototype to expose to collections
 </p>
</td>
<td class="code">
<pre><code><span class="class">Z</span>.<span class="variable">prototype</span> = $.<span class="variable">fn</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose Kranium to global variables
 </p>
</td>
<td class="code">
<pre><code><span class="variable">global</span>.$ = <span class="variable">global</span>.<span class="class">K</span> = <span class="variable">global</span>.<span class="variable">jQuery</span> = <span class="variable">global</span>.<span class="class">Zepto</span> = $;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose Kranium-Jade to global variable
 </p>
</td>
<td class="code">
<pre><code><span class="variable">global</span>.<span class="class">J</span> = <span class="keyword">function</span>(<span class="variable">jadeStr</span>, <span class="variable">o</span>){
    <span class="keyword">return</span> <span class="class">K</span>(<span class="class">K</span>.<span class="variable">jade</span>(<span class="variable">jadeStr</span>, <span class="variable">o</span>));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Cache platform
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">platform</span> = <span class="class">Ti</span>.<span class="class">Platform</span>.<span class="variable">osname</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Basic feature detection
 </p>
</td>
<td class="code">
<pre><code>$.<span class="variable">is</span> = {
    <span class="variable">android</span>: <span class="variable">platform</span> === <span class="string">'android'</span>,
    <span class="variable">ios</span>: <span class="variable">platform</span> === <span class="string">'iphone'</span>
};

})(<span class="this">this</span>);


</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/utils.js"><a href="#">utils</a></h2></td><td>lib/kranium-src/utils.js</td></tr><tr class="code">
<td class="docs">
<p>Define utils
 </p>
</td>
<td class="code">
<pre><code><span class="comment">//(function(global){</span>

<span class="class">K</span>.<span class="variable">isFunc</span> = <span class="keyword">function</span>(<span class="variable">obj</span>){ <span class="keyword">return</span> <span class="variable">toString</span>.<span class="variable">call</span>(<span class="variable">obj</span>) === <span class="string">"[object Function]"</span>; };

<span class="class">K</span>.<span class="variable">get</span> = <span class="keyword">function</span>(<span class="variable">str</span>){ <span class="keyword">return</span> <span class="class">JSON</span>.<span class="variable">parse</span>(<span class="class">Ti</span>.<span class="class">App</span>.<span class="class">Properties</span>.<span class="variable">getString</span>(<span class="variable">str</span>)); };
<span class="class">K</span>.<span class="variable">set</span> = <span class="keyword">function</span>(<span class="variable">str</span>, <span class="variable">val</span>){ <span class="keyword">return</span> <span class="class">Ti</span>.<span class="class">App</span>.<span class="class">Properties</span>.<span class="variable">setString</span>(<span class="variable">str</span>, <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">val</span>)); };

<span class="class">K</span>.<span class="variable">alert</span> = <span class="keyword">function</span>(<span class="variable">message</span>, <span class="variable">title</span>){
<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createAlertDialog</span>({
        <span class="variable">title</span>: <span class="variable">title</span> || <span class="string">'Obs!'</span>,
        <span class="variable">message</span>: <span class="variable">message</span>
    }).<span class="variable">show</span>();
};

<span class="keyword">var</span> <span class="variable">android</span> = <span class="class">Ti</span>.<span class="class">Platform</span>.<span class="variable">osname</span> === <span class="string">'android'</span>;
<span class="class">K</span>.<span class="variable">log</span> = <span class="keyword">function</span>(<span class="variable">a</span>, <span class="variable">b</span>){
<span class="keyword">var</span> <span class="variable">out</span> = (<span class="variable">b</span> ? <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>) : <span class="variable">a</span>);
<span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">"Kranium"</span>, <span class="variable">android</span> ? <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">out</span>) : <span class="variable">out</span>);
};

<span class="class">K</span>.<span class="variable">loadify</span> = <span class="keyword">function</span>(<span class="variable">el</span>, <span class="variable">fn</span>){
<span class="keyword">var</span> <span class="variable">p</span> = <span class="variable">el</span>||<span class="class">GLOBAL</span>.<span class="variable">win</span>||<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">currentWindow</span>,
    <span class="variable">done</span>;
    
<span class="keyword">if</span>(!<span class="variable">p</span>){ <span class="keyword">return</span>; } 

<span class="keyword">if</span>(<span class="variable">p</span> && !<span class="variable">p</span>.<span class="variable">_loader</span>){
    <span class="variable">p</span>.<span class="variable">_loader</span> = <span class="class">K</span>.<span class="variable">createActivityIndicator</span>({
        <span class="variable">className</span>: <span class="string">'loader'</span>,
    });
            
    <span class="variable">p</span>.<span class="variable">add</span>(<span class="variable">p</span>.<span class="variable">_loader</span>);
}

<span class="variable">p</span>.<span class="variable">_loader</span>.<span class="variable">show</span>();

<span class="keyword">if</span>(<span class="variable">fn</span>){ <span class="comment">// Test if func</span>
    <span class="variable">done</span> = <span class="keyword">function</span>(){ <span class="class">K</span>.<span class="variable">doneify</span>(<span class="variable">el</span>); };
    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">fn</span>(<span class="variable">done</span>) !== <span class="string">'undefined'</span>){
        <span class="variable">done</span>();
    }
}
};

<span class="class">K</span>.<span class="variable">doneify</span> = <span class="keyword">function</span>(<span class="variable">el</span>){
<span class="keyword">var</span> <span class="variable">p</span> = <span class="variable">el</span>||<span class="class">GLOBAL</span>.<span class="variable">win</span>||<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">currentWindow</span>;	
<span class="variable">p</span> && <span class="variable">p</span>.<span class="variable">_loader</span> && <span class="variable">setTimeout</span>(<span class="variable">p</span>.<span class="variable">_loader</span>.<span class="variable">hide</span>, <span class="number integer">500</span>);
};

<span class="class">K</span>.<span class="variable">parseJSON</span> = <span class="class">JSON</span>.<span class="variable">parse</span>;

<span class="keyword">function</span> <span class="variable">singleExtend</span>(<span class="variable">destination</span>, <span class="variable">source</span>){
<span class="keyword">var</span> <span class="variable">property</span>;
<span class="keyword">for</span> (<span class="variable">property</span> <span class="keyword">in</span> <span class="variable">source</span>) { <span class="variable">destination</span>[<span class="variable">property</span>] = <span class="variable">source</span>[<span class="variable">property</span>]; }
<span class="keyword">return</span> <span class="variable">destination</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Merge any number of objects where the rightmost has precedence
 - <strong>param</strong>: <em>obj</em>
... Object to be merged
 - <strong>return</strong>: <em>Object</em>
 with all arguments merged
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">extend</span> = <span class="class">K</span>.<span class="variable">extend</span> = <span class="keyword">function</span>(<span class="variable">obj1</span>, <span class="variable">obj2</span>, <span class="variable">obj3</span>){
<span class="keyword">if</span>(!<span class="variable">obj3</span>){
    <span class="keyword">return</span> <span class="variable">singleExtend</span>(<span class="variable">obj1</span>, <span class="variable">obj2</span>);
} <span class="keyword">else</span> {
    <span class="keyword">var</span> <span class="variable">args</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>),
        <span class="variable">obj</span> = <span class="variable">args</span>.<span class="variable">shift</span>();
    <span class="keyword">while</span>(<span class="variable">args</span>.<span class="variable">length</span>){ <span class="variable">obj</span> = <span class="variable">singleExtend</span>.<span class="variable">apply</span>(<span class="keyword">null</span>, [<span class="variable">obj</span>, <span class="variable">args</span>.<span class="variable">shift</span>()]); }
    <span class="keyword">return</span> <span class="variable">obj</span>;
}
};

<span class="keyword">function</span> <span class="variable">singleDeepExtend</span>(<span class="variable">destination</span>, <span class="variable">source</span>){	
<span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">property</span> <span class="keyword">in</span> <span class="variable">source</span>) {
    <span class="keyword">if</span> (<span class="variable">source</span>[<span class="variable">property</span>] && <span class="variable">source</span>[<span class="variable">property</span>].<span class="variable">constructor</span> && <span class="variable">source</span>[<span class="variable">property</span>].<span class="variable">constructor</span> === <span class="class">Object</span>) {
        <span class="variable">destination</span>[<span class="variable">property</span>] = <span class="variable">destination</span>[<span class="variable">property</span>] || {};
        <span class="variable">singleDeepExtend</span>(<span class="variable">destination</span>[<span class="variable">property</span>], <span class="variable">source</span>[<span class="variable">property</span>]);
    } <span class="keyword">else</span> {
        <span class="variable">destination</span>[<span class="variable">property</span>] = <span class="variable">source</span>[<span class="variable">property</span>];
    }
}
<span class="keyword">return</span> <span class="variable">destination</span>;
}

<span class="class">K</span>.<span class="variable">deepExtend</span> = <span class="keyword">function</span>(<span class="variable">obj1</span>, <span class="variable">obj2</span>, <span class="variable">obj3</span>) {
<span class="keyword">if</span>(!<span class="variable">obj3</span>){
    <span class="keyword">return</span> <span class="variable">singleDeepExtend</span>(<span class="variable">obj1</span>, <span class="variable">obj2</span>);
} <span class="keyword">else</span> {
    <span class="keyword">var</span> <span class="variable">args</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>),
        <span class="variable">obj</span> = <span class="variable">args</span>.<span class="variable">shift</span>();
    <span class="keyword">while</span>(<span class="variable">args</span>.<span class="variable">length</span>){ <span class="variable">obj</span> = <span class="variable">singleDeepExtend</span>.<span class="variable">apply</span>(<span class="keyword">null</span>, [<span class="variable">obj</span>, <span class="variable">args</span>.<span class="variable">shift</span>()]); }
    <span class="keyword">return</span> <span class="variable">obj</span>;
}
};

<span class="keyword">if</span>(!<span class="class">Object</span>.<span class="variable">prototype</span>.<span class="variable">ext</span>){
<span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="class">Object</span>.<span class="variable">prototype</span>, <span class="string">"ext"</span>, {
    <span class="variable">enumerable</span>: <span class="variable">false</span>,
    <span class="variable">value</span>: <span class="keyword">function</span>(<span class="variable">from</span>) {
        <span class="keyword">var</span> <span class="variable">dest</span> = <span class="this">this</span>;
        <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">prop</span> <span class="keyword">in</span> <span class="variable">from</span>){
            <span class="variable">dest</span>[<span class="variable">prop</span>] = <span class="variable">from</span>[<span class="variable">prop</span>];
        }
        <span class="keyword">return</span> <span class="this">this</span>;
    }
});
}


<span class="keyword">if</span>(!<span class="class">Object</span>.<span class="variable">prototype</span>.<span class="variable">clone</span>){
<span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="class">Object</span>.<span class="variable">prototype</span>, <span class="string">"clone"</span>, {
    <span class="variable">enumerable</span>: <span class="variable">false</span>,
    <span class="variable">value</span>: <span class="keyword">function</span>() {
        <span class="keyword">return</span> ({}).<span class="variable">ext</span>(<span class="this">this</span>);
    }
});
}

<span class="keyword">if</span>(!<span class="class">Object</span>.<span class="variable">prototype</span>.<span class="variable">sanitize</span>){
<span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="class">Object</span>.<span class="variable">prototype</span>, <span class="string">"sanitize"</span>, {
    <span class="variable">enumerable</span>: <span class="variable">false</span>,
    <span class="variable">value</span>: <span class="keyword">function</span>(<span class="variable">props</span>) {
        <span class="keyword">var</span> <span class="variable">me</span> = <span class="this">this</span>.<span class="variable">clone</span>();
        (<span class="variable">props</span>||[]).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">prop</span>){
            <span class="keyword">delete</span> <span class="variable">me</span>[<span class="variable">prop</span>];
        });
        <span class="keyword">return</span> <span class="variable">me</span>;
    }
});
}

<span class="keyword">if</span>(!<span class="class">Object</span>.<span class="variable">prototype</span>.<span class="variable">or</span>){
<span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="class">Object</span>.<span class="variable">prototype</span>, <span class="string">"or"</span>, {
    <span class="variable">enumerable</span>: <span class="variable">false</span>,
    <span class="variable">value</span>: <span class="keyword">function</span>(<span class="variable">val</span>) {
        <span class="keyword">return</span> <span class="class">Array</span>.<span class="variable">isArray</span>(<span class="this">this</span>) ? (<span class="this">this</span>.<span class="variable">length</span> === <span class="number integer">0</span> ? <span class="variable">val</span> : <span class="this">this</span>) : (<span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="this">this</span>) === <span class="string">'{}'</span> ? <span class="variable">val</span>: <span class="this">this</span>);
    }
});
}

<span class="keyword">if</span>(!<span class="class">Object</span>.<span class="variable">prototype</span>.<span class="variable">arrayify</span>){
<span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="class">Object</span>.<span class="variable">prototype</span>, <span class="string">"arrayify"</span>, {
    <span class="variable">enumerable</span>: <span class="variable">false</span>,
    <span class="variable">value</span>: <span class="keyword">function</span>() {
        <span class="keyword">return</span> <span class="class">Array</span>.<span class="variable">isArray</span>(<span class="this">this</span>) ? <span class="this">this</span> : [<span class="this">this</span>];
    }
});
}

<span class="keyword">if</span>(!<span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">defer</span>){
<span class="class">Object</span>.<span class="variable">defineProperty</span>(<span class="class">Function</span>.<span class="variable">prototype</span>, <span class="string">"defer"</span>, {
    <span class="variable">enumerable</span>: <span class="variable">false</span>,
    <span class="variable">value</span>: <span class="keyword">function</span>(<span class="variable">ms</span>, <span class="variable">_scope</span>) {
        <span class="keyword">var</span> <span class="variable">fn</span> = <span class="this">this</span>; 
        <span class="keyword">return</span> <span class="keyword">function</span>(){
            <span class="keyword">var</span> <span class="variable">scope</span> = (<span class="variable">_scope</span> && <span class="this">this</span> === <span class="variable">arguments</span>.<span class="variable">callee</span>) ? <span class="variable">_scope</span> : <span class="this">this</span>,
                <span class="variable">args</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>);
            
            <span class="variable">setTimeout</span>(<span class="keyword">function</span>(){ <span class="variable">fn</span>.<span class="variable">apply</span>(<span class="variable">scope</span>||<span class="variable">fn</span>, <span class="variable">args</span>); }, <span class="variable">ms</span>);
        };
    }
});
}

<span class="class">Number</span>.<span class="variable">prototype</span>.<span class="variable">round</span> = <span class="keyword">function</span>(<span class="variable">n</span>){
<span class="keyword">var</span> <span class="variable">n</span> = <span class="variable">n</span> || <span class="number integer">0</span>, <span class="variable">pow</span> = <span class="class">Math</span>.<span class="variable">pow</span>(<span class="number integer">10</span>, <span class="variable">n</span>);
<span class="keyword">return</span> (<span class="class">Math</span>.<span class="variable">round</span>(<span class="this">this</span> * <span class="variable">pow</span>) / <span class="variable">pow</span>).<span class="variable">toFixed</span>(<span class="variable">n</span> >= <span class="number integer">0</span> ? <span class="variable">n</span> : <span class="number integer">0</span>);
};

<span class="keyword">if</span> (!<span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">remove</span>) {
    <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">remove</span> = <span class="keyword">function</span>(<span class="variable">elem</span>, <span class="variable">max</span>) {
        <span class="keyword">var</span> <span class="variable">index</span>, <span class="variable">i</span> = <span class="number integer">0</span>;
        <span class="keyword">while</span>((<span class="variable">index</span> = <span class="this">this</span>.<span class="variable">indexOf</span>(<span class="variable">elem</span>)) != -<span class="number integer">1</span> && (!<span class="variable">max</span> || <span class="variable">i</span> < <span class="variable">max</span>)) {
            <span class="this">this</span>.<span class="variable">splice</span>(<span class="variable">index</span>, <span class="number integer">1</span>);
            <span class="variable">i</span>++;
        }
        <span class="keyword">return</span> <span class="this">this</span>;
    };
}	

<span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">pluck</span> = <span class="keyword">function</span>(<span class="variable">prop</span>){
<span class="keyword">return</span> <span class="this">this</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">o</span>){ <span class="keyword">return</span> <span class="variable">o</span>[<span class="variable">prop</span>]; });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Bind a function to a context
 - <strong>param</strong>: <em>ctx</em>
 Context to run the function in
 - <strong>return</strong>: <em>Function</em>
 applying new scope to original function
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">slice</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>;
<span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">bind</span> = <span class="keyword">function</span>(<span class="variable">ctx</span>){ 
<span class="keyword">var</span> <span class="variable">fn</span> = <span class="this">this</span>;
<span class="keyword">return</span> <span class="keyword">function</span>(){ 
    <span class="variable">fn</span>.<span class="variable">apply</span>(<span class="variable">ctx</span> || <span class="variable">fn</span>, <span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>)); 
}; 
};

<span class="keyword">var</span> <span class="variable">slice</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>;
<span class="class">Function</span>.<span class="variable">prototype</span>.<span class="variable">once</span> = <span class="keyword">function</span>(<span class="variable">ctx</span>){ 
<span class="keyword">var</span> <span class="variable">fn</span> = <span class="this">this</span>, <span class="variable">i</span> = <span class="number integer">0</span>;
<span class="keyword">return</span> <span class="keyword">function</span>(){ 
    <span class="keyword">return</span> ++<span class="variable">i</span> <= <span class="number integer">1</span> && <span class="variable">fn</span>.<span class="variable">apply</span>(<span class="variable">ctx</span> || <span class="variable">fn</span>, <span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>)); 
}; 
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert camelCase to dashed notation
 - <strong>return</strong>: <em>String</em>
 with uppercase letters converted to dashed notation
 </p>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">toDash</span> = <span class="keyword">function</span>(){
<span class="keyword">return</span> <span class="this">this</span>.<span class="variable">replace</span>(<span class="regexp">/([A-Z])/g</span>, <span class="keyword">function</span>($<span class="number integer">1</span>){<span class="keyword">return</span> <span class="string">"-"</span>+$<span class="number integer">1</span>.<span class="variable">toLowerCase</span>();});
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Convert dashed notation to camelCase
 - <strong>return</strong>: <em>String</em>
 with dashed notation converted to camelCase
 </p>
</td>
<td class="code">
<pre><code><span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">toCamel</span> = <span class="keyword">function</span>(){
<span class="keyword">return</span> <span class="this">this</span>.<span class="variable">replace</span>(<span class="regexp">/(\-[a-z])/g</span>, <span class="keyword">function</span>($<span class="number integer">1</span>){<span class="keyword">return</span> $<span class="number integer">1</span>.<span class="variable">toUpperCase</span>().<span class="variable">replace</span>(<span class="string">'-'</span>,<span class="string">''</span>);});
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Trim a string of leading and trailing whitespace
 - <strong>return</strong>: <em>String</em>
 trimmed of whitespace
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">rtrim</span> = <span class="regexp">/^\s+|\s+$/g</span>;
<span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">trim</span> = <span class="keyword">function</span>(){
<span class="keyword">return</span> <span class="this">this</span>.<span class="variable">replace</span>(<span class="variable">rtrim</span>, <span class="string">""</span>);	
};

<span class="class">String</span>.<span class="variable">prototype</span>.<span class="variable">esc</span> = <span class="keyword">function</span>(<span class="variable">obj</span>, <span class="variable">func</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">replace</span>(<span class="regexp">/#\{([A-Za-z_]+)\}/g</span>, <span class="keyword">function</span>($<span class="number integer">0</span>, $<span class="number integer">1</span>){
        <span class="keyword">return</span> <span class="keyword">typeof</span> <span class="variable">obj</span>[$<span class="number integer">1</span>] != <span class="string">"undefined"</span> ? (<span class="variable">func</span> ? <span class="variable">func</span>(<span class="variable">obj</span>[$<span class="number integer">1</span>]) : <span class="variable">obj</span>[$<span class="number integer">1</span>]) : $<span class="number integer">0</span>;
    });
};

<span class="comment">//})(this);</span></code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/qsa.js"><a href="#">qsa</a></h2></td><td>lib/kranium-src/qsa.js</td></tr><tr class="code">
<td class="docs">
<p>"mini" Selector Engine
Copyright (c) 2009 James Padolsey</p>

<hr></hr>

<p>Dual licensed under the MIT and GPL licenses.
   - http://www.opensource.org/licenses/mit-license.php
   - http://www.gnu.org/copyleft/gpl.html</p>

<hr></hr>

<h2>Version 0.01 (BETA)</h2>
</td>
<td class="code">
<pre><code>$.<span class="variable">qsa</span> = $$ = (<span class="keyword">function</span>(<span class="variable">document</span>, <span class="variable">global</span>){

<span class="keyword">var</span> <span class="variable">me</span> = <span class="variable">document</span>;
[
    { <span class="variable">fn</span>: <span class="string">"getElementsByClassName"</span>, <span class="variable">arrName</span>: <span class="string">"elsByClassName"</span> },
    { <span class="variable">fn</span>: <span class="string">"getElementsByTagName"</span>, <span class="variable">arrName</span>: <span class="string">"elsByName"</span> },
    { <span class="variable">fn</span>: <span class="string">"getElementById"</span>, <span class="variable">arrName</span>: <span class="string">"elsById"</span> }
].<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">o</span>){
    <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">o</span>.<span class="variable">fn</span>, 
        <span class="variable">arrName</span> = <span class="variable">o</span>.<span class="variable">arrName</span>,
        <span class="variable">singular</span> = (<span class="variable">o</span>.<span class="variable">fn</span> == <span class="string">"getElementById"</span>), 
        <span class="variable">a</span>, 
        <span class="variable">res</span>;

    <span class="variable">me</span>[<span class="variable">name</span>] = <span class="variable">global</span>[<span class="variable">name</span>] = <span class="keyword">function</span>(<span class="variable">s</span>, <span class="variable">context</span>){
        <span class="keyword">var</span> <span class="variable">arr</span> = <span class="class">K</span>[<span class="variable">arrName</span>],
            <span class="variable">res</span> = <span class="keyword">null</span>;

        <span class="keyword">if</span>((<span class="variable">a</span> = <span class="variable">arr</span>[<span class="variable">s</span>]) && (<span class="variable">a</span> = (<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">a</span>) ? <span class="variable">a</span> : [<span class="variable">a</span>]))){
            <span class="keyword">if</span>(<span class="variable">context</span>){
                <span class="variable">res</span> = <span class="variable">a</span>.<span class="variable">filter</span>(<span class="keyword">function</span>(<span class="variable">el</span>){
                    <span class="keyword">do</span> {
                        <span class="keyword">if</span>(<span class="variable">el</span>.<span class="variable">_uuid</span> === <span class="variable">context</span>.<span class="variable">_uuid</span>){ <span class="keyword">return</span> <span class="variable">true</span>; }
                    } <span class="keyword">while</span>((<span class="variable">el</span> = (<span class="variable">el</span>.<span class="variable">getParent</span>()) ));
                    <span class="keyword">return</span> <span class="variable">false</span>;
                });
            } <span class="keyword">else</span> {
                <span class="variable">res</span> = <span class="variable">a</span>;
            }
        }

        <span class="keyword">return</span> <span class="variable">singular</span> ? <span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">res</span>) && <span class="variable">res</span>[<span class="number integer">0</span>] : <span class="variable">res</span>;
    };
});


    <span class="keyword">var</span> <span class="variable">snack</span> = <span class="regexp">/(?:[\w\-\\.#]+)+(?:\[\w+?=([\'"])?(?:\\\1|.)+?\1\])?|\*|>/ig</span>,
        <span class="variable">exprClassName</span> = <span class="regexp">/^(?:[\w\-_]+)?\.([\w\-_]+)/</span>,
        <span class="variable">exprId</span> = <span class="regexp">/^(?:[\w\-_]+)?#([\w\-_]+)/</span>,
        <span class="variable">exprNodeName</span> = <span class="regexp">/^([\w\*\-_]+)/</span>,
        <span class="variable">na</span> = [<span class="keyword">null</span>,<span class="keyword">null</span>];

    <span class="keyword">function</span> <span class="variable">_find</span>(<span class="variable">selector</span>, <span class="variable">context</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>This is what you call via x()
Starts everything off...
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">simple</span> = <span class="regexp">/^[\w\-_#]+$/</span>.<span class="variable">test</span>(<span class="variable">selector</span>);
    
        <span class="keyword">if</span> (<span class="variable">selector</span>.<span class="variable">indexOf</span>(<span class="string">','</span>) > -<span class="number integer">1</span>) {
            <span class="keyword">var</span> <span class="variable">split</span> = <span class="variable">selector</span>.<span class="variable">split</span>(<span class="regexp">/,/g</span>), <span class="variable">ret</span> = [], <span class="variable">sIndex</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">split</span>.<span class="variable">length</span>;
            <span class="keyword">for</span>(; <span class="variable">sIndex</span> < <span class="variable">len</span>; ++<span class="variable">sIndex</span>) {
                <span class="variable">ret</span> = <span class="variable">ret</span>.<span class="variable">concat</span>( <span class="variable">_find</span>(<span class="variable">split</span>[<span class="variable">sIndex</span>], <span class="variable">context</span>) );
            }
            <span class="keyword">return</span> <span class="variable">unique</span>(<span class="variable">ret</span>);
        }

        <span class="keyword">var</span> <span class="variable">parts</span> = <span class="variable">selector</span>.<span class="variable">match</span>(<span class="variable">snack</span>),
            <span class="variable">part</span> = <span class="variable">parts</span>.<span class="variable">pop</span>(),
            <span class="variable">id</span> = (<span class="variable">part</span>.<span class="variable">match</span>(<span class="variable">exprId</span>) || <span class="variable">na</span>)[<span class="number integer">1</span>],
            <span class="variable">className</span> = !<span class="variable">id</span> && (<span class="variable">part</span>.<span class="variable">match</span>(<span class="variable">exprClassName</span>) || <span class="variable">na</span>)[<span class="number integer">1</span>],
            <span class="variable">nodeName</span> = !<span class="variable">id</span> && (<span class="variable">part</span>.<span class="variable">match</span>(<span class="variable">exprNodeName</span>) || <span class="variable">na</span>)[<span class="number integer">1</span>],
            <span class="variable">collection</span>,
        <span class="variable">el</span>;

        <span class="keyword">if</span> (<span class="variable">className</span> && !<span class="variable">nodeName</span>) {
            <span class="variable">collection</span> = <span class="variable">realArray</span>(<span class="variable">getElementsByClassName</span>(<span class="variable">className</span>, <span class="variable">context</span>));
        } <span class="keyword">else</span> {
            <span class="variable">collection</span> = !<span class="variable">id</span> && <span class="variable">realArray</span>(<span class="variable">getElementsByTagName</span>(<span class="variable">nodeName</span>||<span class="string">'*'</span>, <span class="variable">context</span>));
        <span class="keyword">if</span> (<span class="variable">className</span>) {
                <span class="variable">collection</span> = <span class="variable">filterByAttr</span>(<span class="variable">collection</span>, <span class="string">'className'</span>, <span class="class">RegExp</span>(<span class="string">'(^|\\s)'</span> + <span class="variable">className</span> + <span class="string">'(\\s|$)'</span>));
            }
            <span class="keyword">if</span> (<span class="variable">id</span>) {
                <span class="keyword">return</span> (<span class="variable">el</span> = <span class="variable">getElementById</span>(<span class="variable">id</span>, <span class="variable">context</span>)) ? [<span class="variable">el</span>] : [];
            }
        }
    
    <span class="keyword">var</span> <span class="variable">ret</span> = <span class="variable">parts</span>[<span class="number integer">0</span>] && <span class="variable">collection</span>[<span class="number integer">0</span>] ? <span class="variable">filterParents</span>(<span class="variable">parts</span>, <span class="variable">collection</span>, <span class="variable">false</span>, <span class="variable">context</span>) : <span class="variable">collection</span>;
    <span class="keyword">return</span> <span class="variable">ret</span>;
    }

    <span class="keyword">function</span> <span class="variable">realArray</span>(<span class="variable">c</span>) { <span class="keyword">return</span> <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">c</span>); }

    <span class="keyword">function</span> <span class="variable">filterParents</span>(<span class="variable">selectorParts</span>, <span class="variable">collection</span>, <span class="variable">direct</span>, <span class="variable">context</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>This is where the magic happens.
Parents are stepped through (upwards) to
see if they comply with the selector.
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">parentSelector</span> = <span class="variable">selectorParts</span>.<span class="variable">pop</span>()||<span class="string">''</span>;
        <span class="keyword">if</span> (<span class="variable">parentSelector</span> === <span class="string">'>'</span>) { <span class="keyword">return</span> <span class="variable">filterParents</span>(<span class="variable">selectorParts</span>, <span class="variable">collection</span>, <span class="variable">true</span>, <span class="variable">context</span>); }

        <span class="keyword">var</span> <span class="variable">ret</span> = [],
            <span class="variable">r</span> = -<span class="number integer">1</span>,
            <span class="variable">id</span> = (<span class="variable">parentSelector</span>.<span class="variable">match</span>(<span class="variable">exprId</span>) || <span class="variable">na</span>)[<span class="number integer">1</span>],
            <span class="variable">className</span> = !<span class="variable">id</span> && (<span class="variable">parentSelector</span>.<span class="variable">match</span>(<span class="variable">exprClassName</span>) || <span class="variable">na</span>)[<span class="number integer">1</span>],
            <span class="variable">nodeName</span> = !<span class="variable">id</span> && (<span class="variable">parentSelector</span>.<span class="variable">match</span>(<span class="variable">exprNodeName</span>) || <span class="variable">na</span>)[<span class="number integer">1</span>],
            <span class="variable">cIndex</span> = -<span class="number integer">1</span>,
            <span class="variable">node</span>, <span class="variable">parent</span>,
            <span class="variable">matches</span>;

        <span class="keyword">while</span> ( (<span class="variable">node</span> = <span class="variable">collection</span>[++<span class="variable">cIndex</span>]) ) {
            <span class="keyword">if</span>(<span class="variable">context</span>){
            <span class="keyword">if</span>(<span class="variable">node</span>.<span class="variable">getParent</span>().<span class="variable">_uuid</span> == <span class="variable">context</span>.<span class="variable">_uuid</span>){
                <span class="variable">ret</span>[++<span class="variable">r</span>] = <span class="variable">node</span>;
            }
        } <span class="keyword">else</span> {
            <span class="variable">parent</span> = <span class="variable">node</span>.<span class="variable">getParent</span>();
            <span class="keyword">do</span> {
                <span class="variable">matches</span> = !<span class="variable">nodeName</span> || <span class="variable">nodeName</span> === <span class="string">'*'</span> || <span class="variable">nodeName</span> === <span class="variable">parent</span>.<span class="variable">_type</span>;
                <span class="variable">matches</span> = <span class="variable">matches</span> && (!<span class="variable">id</span> || <span class="variable">parent</span>.<span class="variable">_id</span> === <span class="variable">id</span>);
                <span class="variable">matches</span> = <span class="variable">matches</span> && (!<span class="variable">className</span> || <span class="class">RegExp</span>(<span class="string">'(^|\\s)'</span> + <span class="variable">className</span> + <span class="string">'(\\s|$)'</span>).<span class="variable">test</span>(<span class="variable">parent</span>.<span class="variable">className</span>));
                <span class="keyword">if</span> (<span class="variable">direct</span> || <span class="variable">matches</span>) { <span class="keyword">break</span>; }
            } <span class="keyword">while</span> ( (<span class="variable">parent</span> = <span class="variable">parent</span>.<span class="variable">getParent</span>()) );
            <span class="keyword">if</span> (<span class="variable">matches</span>) { <span class="variable">ret</span>[++<span class="variable">r</span>] = <span class="variable">node</span>; }
        }
        
        }
        <span class="keyword">return</span> <span class="variable">selectorParts</span>[<span class="number integer">0</span>] && <span class="variable">ret</span>[<span class="number integer">0</span>] ? <span class="variable">filterParents</span>(<span class="variable">selectorParts</span>, <span class="variable">ret</span>) : <span class="variable">ret</span>;
    }


    <span class="keyword">var</span> <span class="variable">unique</span> = (<span class="keyword">function</span>() {
    <span class="keyword">var</span> <span class="variable">uid</span> = +<span class="keyword">new</span> <span class="class">Date</span>(),
        <span class="variable">data</span> = (<span class="keyword">function</span>() {

        <span class="keyword">var</span> <span class="variable">n</span> = <span class="number integer">1</span>;
        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="variable">elem</span>) {
            <span class="keyword">var</span> <span class="variable">cacheIndex</span> = <span class="variable">elem</span>[<span class="variable">uid</span>],
                <span class="variable">nextCacheIndex</span> = <span class="variable">n</span>++;

            <span class="keyword">if</span> (!<span class="variable">cacheIndex</span>) {
                <span class="variable">elem</span>[<span class="variable">uid</span>] = <span class="variable">nextCacheIndex</span>;
                <span class="keyword">return</span> <span class="variable">true</span>;
            }
            <span class="keyword">return</span> <span class="variable">false</span>;
        };

    })();

    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="variable">arr</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Returns a unique array
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">length</span> = <span class="variable">arr</span>.<span class="variable">length</span>,
            <span class="variable">ret</span> = [],
            <span class="variable">r</span> = -<span class="number integer">1</span>,
            <span class="variable">i</span> = <span class="number integer">0</span>,
            <span class="variable">item</span>;

        <span class="keyword">for</span> (; <span class="variable">i</span> < <span class="variable">length</span>; ++<span class="variable">i</span>) {
            <span class="variable">item</span> = <span class="variable">arr</span>[<span class="variable">i</span>];
            <span class="keyword">if</span> (<span class="variable">data</span>(<span class="variable">item</span>)) { <span class="variable">ret</span>[++<span class="variable">r</span>] = <span class="variable">item</span>; }
        }

        <span class="variable">uid</span> += <span class="number integer">1</span>;
        <span class="keyword">return</span> <span class="variable">ret</span>;
    };
})();

    <span class="keyword">function</span> <span class="variable">filterByAttr</span>(<span class="variable">collection</span>, <span class="variable">attr</span>, <span class="variable">regex</span>) {</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Filters a collection by an attribute.
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">i</span> = -<span class="number integer">1</span>, <span class="variable">node</span>, <span class="variable">r</span> = -<span class="number integer">1</span>, <span class="variable">ret</span> = [];
        <span class="keyword">while</span> ( (<span class="variable">node</span> = <span class="variable">collection</span>[++<span class="variable">i</span>]) ) {
            <span class="keyword">if</span> (<span class="variable">regex</span>.<span class="variable">test</span>(<span class="variable">node</span>[<span class="variable">attr</span>])) {
                <span class="variable">ret</span>[++<span class="variable">r</span>] = <span class="variable">node</span>;
            }
        }
        <span class="keyword">return</span> <span class="variable">ret</span>;
    }
    <span class="keyword">return</span> <span class="variable">_find</span>;

})(<span class="this">this</span>, <span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/klass.js"><a href="#">klass</a></h2></td><td>lib/kranium-src/klass.js</td></tr><tr class="code">
<td class="docs">
<p> Simple JavaScript Inheritance
By John Resig http://ejohn.org/
MIT Licensed.
 </p>
</td>
<td class="code">
<pre><code><span class="comment">// Inspired by base2 and Prototype</span>
(<span class="keyword">function</span>(<span class="variable">global</span>){

<span class="class">K</span>.<span class="variable">classes</span> = {};
<span class="class">K</span>.<span class="variable">loadClass</span> = <span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">liveKlass</span>){
    <span class="keyword">var</span> <span class="variable">klass</span>, <span class="variable">cls</span>;
    <span class="keyword">if</span>(<span class="variable">global</span>.<span class="class">DEBUG</span> || <span class="variable">liveKlass</span> || !(<span class="variable">klass</span> = <span class="class">K</span>.<span class="variable">classes</span>[<span class="variable">name</span>])){
        <span class="keyword">if</span>(!<span class="variable">liveKlass</span>){ <span class="class">K</span>.<span class="variable">loadStyle</span>(<span class="variable">name</span>); }
        <span class="variable">klass</span> = <span class="variable">liveKlass</span>||(<span class="variable">exports</span> = {}, <span class="class">Ti</span>.<span class="variable">include</span>(<span class="string">'kui/'</span> + <span class="variable">name</span> + <span class="string">'.js'</span>), <span class="variable">exports</span>.<span class="class">Class</span>);
        <span class="variable">cls</span> = <span class="variable">klass</span>.<span class="variable">prototype</span>.<span class="variable">className</span>;
        <span class="variable">klass</span>.<span class="variable">prototype</span>.<span class="variable">className</span> = <span class="variable">cls</span> ? <span class="variable">cls</span> + <span class="string">' '</span> + <span class="variable">name</span> : <span class="variable">name</span>;
        <span class="variable">klass</span>.<span class="variable">prototype</span>.<span class="variable">_klass</span> = <span class="variable">name</span>;
        
        <span class="class">K</span>.<span class="variable">classes</span>[<span class="variable">name</span>] = <span class="variable">klass</span>;
    }
    <span class="keyword">return</span> <span class="variable">klass</span>;
};


<span class="keyword">var</span> <span class="variable">initializing</span> = <span class="variable">false</span>,
    <span class="variable">fnTest</span> = <span class="regexp">/xyz/</span>.<span class="variable">test</span>(<span class="keyword">function</span>() {<span class="variable">xyz</span>;}) ? <span class="regexp">/\b_super\b/</span> : <span class="regexp">/.*/</span>;

<span class="comment">// The base Class implementation (does nothing)</span>
<span class="this">this</span>.<span class="class">Class</span> = <span class="keyword">function</span>() {};

<span class="comment">// Create a new Class that inherits from this class</span>
<span class="class">Class</span>.<span class="variable">extend</span> = <span class="keyword">function</span>(<span class="variable">prop</span>, <span class="variable">o</span>) {
    <span class="comment">// Extended with autoloading</span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">prop</span> === <span class="string">'string'</span> && <span class="variable">o</span>) {
        <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">loadClass</span>(<span class="variable">prop</span>).<span class="variable">extend</span>(<span class="variable">o</span>);
    }

    <span class="keyword">var</span> <span class="variable">_super</span> = <span class="this">this</span>.<span class="variable">prototype</span>;

    <span class="comment">// Instantiate a base class (but only create the instance,</span>
    <span class="comment">// don't run the init constructor)</span>
    <span class="variable">initializing</span> = <span class="variable">true</span>;
    <span class="keyword">var</span> <span class="variable">prototype</span> = <span class="keyword">new</span> <span class="this">this</span>();
    <span class="variable">initializing</span> = <span class="variable">false</span>;

    <span class="comment">// Copy the properties over onto the new prototype</span>
    <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">name</span> <span class="keyword">in</span> <span class="variable">prop</span>) {
        <span class="comment">// Check if we're overwriting an existing function</span>
        <span class="variable">prototype</span>[<span class="variable">name</span>] = <span class="keyword">typeof</span> <span class="variable">prop</span>[<span class="variable">name</span>] == <span class="string">"function"</span> && <span class="keyword">typeof</span> <span class="variable">_super</span>[<span class="variable">name</span>] == <span class="string">"function"</span> && <span class="variable">fnTest</span>.<span class="variable">test</span>(<span class="variable">prop</span>[<span class="variable">name</span>]) ? (<span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">fn</span>) {
            <span class="keyword">return</span> <span class="keyword">function</span>() {
                <span class="keyword">var</span> <span class="variable">tmp</span> = <span class="this">this</span>.<span class="variable">_super</span>;

                <span class="comment">// Add a new ._super() method that is the same method</span>
                <span class="comment">// but on the super-class</span>
                <span class="this">this</span>.<span class="variable">_super</span> = <span class="variable">_super</span>[<span class="variable">name</span>];

                <span class="comment">// The method only need to be bound temporarily, so we</span>
                <span class="comment">// remove it when we're done executing</span>
                <span class="keyword">var</span> <span class="variable">ret</span> = <span class="variable">fn</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">arguments</span>);
                <span class="this">this</span>.<span class="variable">_super</span> = <span class="variable">tmp</span>;

                <span class="keyword">return</span> <span class="variable">ret</span>;
            };
        })(<span class="variable">name</span>, <span class="variable">prop</span>[<span class="variable">name</span>]) : <span class="variable">prop</span>[<span class="variable">name</span>];
    }

    <span class="comment">// The dummy class constructor</span>
    <span class="comment">// Slight modification to set init return value to default el</span>
    <span class="keyword">var</span> <span class="variable">el</span>;


    <span class="keyword">function</span> <span class="class">Class</span>(<span class="variable">o</span>) {
        <span class="comment">// All construction is actually done in the init method</span>
        <span class="keyword">if</span> (!<span class="variable">initializing</span> && <span class="this">this</span>.<span class="variable">init</span>) {
            <span class="variable">o</span> && <span class="class">K</span>.<span class="variable">extend</span>(<span class="this">this</span>, <span class="variable">o</span>);
            (<span class="variable">el</span> = <span class="this">this</span>.<span class="variable">init</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">arguments</span>)) && !<span class="this">this</span>.<span class="variable">el</span> && (<span class="this">this</span>.<span class="variable">el</span> = <span class="variable">el</span>);
        }
    }

    <span class="comment">// Populate our constructed prototype object</span>
    <span class="class">Class</span>.<span class="variable">prototype</span> = <span class="variable">prototype</span>;

    <span class="comment">// Enforce the constructor to be what we expect</span>
    <span class="class">Class</span>.<span class="variable">constructor</span> = <span class="class">Class</span>;

    <span class="comment">// And make this class extendable</span>
    <span class="class">Class</span>.<span class="variable">extend</span> = <span class="variable">arguments</span>.<span class="variable">callee</span>;

    <span class="keyword">return</span> <span class="class">Class</span>;
};

})(<span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/file.js"><a href="#">file</a></h2></td><td>lib/kranium-src/file.js</td></tr><tr class="code">
<td class="docs">
<p>Define file module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(){</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Simplified path map
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">pathMap</span> = {
    <span class="variable">res</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">resourcesDirectory</span>,
    <span class="variable">resources</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">resourcesDirectory</span>,
    <span class="variable">tmp</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">tempDirectory</span>,
    <span class="variable">temp</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">tempDirectory</span>,
    <span class="variable">app</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">applicationDirectory</span>,
    <span class="variable">data</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">applicationDataDirectory</span>,
    <span class="variable">support</span>: <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">applicationSupportDirectory</span>
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Simplified file handler</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  file </p></li><li><p><strong>returns</strong>: <em>TiFile | String</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">file</span> = <span class="keyword">function</span>(<span class="variable">file</span>){
    <span class="keyword">var</span> <span class="variable">parts</span> = <span class="variable">file</span>.<span class="variable">match</span>(<span class="regexp">/((\w+):\/</span>\<span class="regexp">/)?(.*?\.?)(\w+)$/</span>),
        <span class="variable">dir</span> = <span class="variable">pathMap</span>[<span class="variable">parts</span>[<span class="number integer">2</span>]||<span class="string">'res'</span>]||<span class="variable">pathMap</span>.<span class="variable">res</span>,
        <span class="variable">path</span> = <span class="variable">parts</span>[<span class="number integer">3</span>]+<span class="variable">parts</span>[<span class="number integer">4</span>];
    
    
    <span class="keyword">var</span> <span class="variable">f</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">getFile</span>(<span class="variable">dir</span>, <span class="variable">path</span>), <span class="variable">res</span> = <span class="variable">f</span>;

    <span class="keyword">try</span> {
        <span class="keyword">switch</span>(<span class="variable">parts</span>[<span class="number integer">4</span>]){
            <span class="keyword">case</span> <span class="string">'txt'</span>:
            <span class="keyword">case</span> <span class="string">'js'</span>:
            <span class="keyword">case</span> <span class="string">'kss'</span>:
            <span class="keyword">case</span> <span class="string">'html'</span>:
            <span class="keyword">case</span> <span class="string">'css'</span>:
            <span class="keyword">case</span> <span class="string">'jade'</span>:
                <span class="variable">res</span> = <span class="variable">f</span>.<span class="variable">exists</span>() ? <span class="variable">f</span>.<span class="variable">read</span>().<span class="variable">text</span> : <span class="variable">false</span>;
                <span class="keyword">break</span>;
        }
    } <span class="keyword">catch</span>(<span class="variable">e</span>){ <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">e</span>); }
    <span class="keyword">return</span> <span class="variable">res</span>;
};

})();</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/style.js"><a href="#">style</a></h2></td><td>lib/kranium-src/style.js</td></tr><tr class="code">
<td class="docs">
<p>Define style module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){

<span class="keyword">var</span> <span class="variable">styles</span> = <span class="class">K</span>.<span class="variable">styles</span> = {},
    <span class="variable">extend</span> = <span class="class">K</span>.<span class="variable">extend</span>;
    
<span class="class">K</span>.<span class="variable">extendStyle</span> = <span class="class">K</span>.<span class="variable">addStyle</span> = <span class="keyword">function</span>(<span class="variable">opts</span>){
    <span class="class">K</span>.<span class="variable">extend</span>(<span class="variable">styles</span>, <span class="variable">opts</span> || {});
};

<span class="comment">// The current window - added to K._els to achieve immediate styling</span>
<span class="keyword">var</span> <span class="class">Window</span> = (<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">currentWindow</span> || <span class="variable">global</span>.<span class="variable">win</span>) || {};
<span class="class">Window</span>.<span class="variable">_type</span> = <span class="string">'window'</span>;

<span class="keyword">var</span> <span class="variable">els</span> = <span class="class">K</span>.<span class="variable">_els</span> = <span class="class">K</span>.<span class="variable">_els</span> || [<span class="class">Window</span>];
<span class="keyword">var</span> <span class="variable">styleCache</span> = {};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Calculating style for object
 - <strong>param</strong>: <em>opts</em>
 Object containing options OR String containing selector
 - <strong>param</strong>: <em>type</em>
 String type of object
 - <strong>return</strong>: <em>Object</em>
 of calculated style 
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">getStyle</span> = <span class="class">K</span>.<span class="variable">getStyle</span> = <span class="keyword">function</span>(<span class="variable">opts</span>, <span class="variable">type</span>){
    <span class="keyword">var</span> <span class="variable">i</span>;
    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">opts</span> === <span class="string">'string'</span>){ <span class="variable">opts</span> = { <span class="variable">className</span>: <span class="variable">opts</span> }; }
    <span class="keyword">var</span> <span class="variable">elStyle</span>, <span class="variable">c</span>, <span class="variable">hash</span> = <span class="variable">type</span>+(<span class="variable">opts</span> && <span class="variable">opts</span>.<span class="variable">cls</span>+<span class="variable">opts</span>.<span class="variable">className</span>);
    <span class="keyword">if</span> (!(<span class="variable">elStyle</span> = <span class="variable">styleCache</span>[<span class="variable">hash</span>])) {
        <span class="variable">elStyle</span> = <span class="variable">styles</span>[<span class="variable">type</span>] ? <span class="variable">extend</span>({}, <span class="variable">styles</span>[<span class="variable">type</span>]) : {};
        <span class="keyword">if</span> (<span class="variable">opts</span> && (<span class="variable">c</span> = (<span class="variable">opts</span>.<span class="variable">className</span> || <span class="variable">opts</span>.<span class="variable">cls</span>))) {
            <span class="keyword">var</span> <span class="variable">parts</span> = <span class="variable">c</span>.<span class="variable">split</span>(<span class="string">" "</span>), <span class="variable">len</span> = <span class="variable">parts</span>.<span class="variable">length</span>;
            <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> < <span class="variable">len</span>; <span class="variable">i</span>++) {
                <span class="keyword">if</span> ((<span class="variable">s</span> = <span class="variable">styles</span>[<span class="string">'.'</span>+<span class="variable">parts</span>[<span class="variable">i</span>]])) {
                    <span class="variable">elStyle</span> = <span class="variable">extend</span>(<span class="variable">elStyle</span>, <span class="variable">s</span>);
                }
            }
        }
        <span class="variable">styleCache</span>[<span class="variable">hash</span>] = <span class="variable">elStyle</span>;
    }
    <span class="keyword">return</span> <span class="variable">extend</span>({}, <span class="variable">elStyle</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Refresh all styles with optional style injection
 - <strong>param</strong>: <em>styleString</em>
 String containing JSS to be parsed and injected into style. Optional.
 </p>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">refreshStyles</span> = <span class="keyword">function</span>(<span class="variable">styleString</span>, <span class="variable">_els</span>){
    <span class="keyword">if</span>(<span class="variable">styleString</span>){
        <span class="variable">styleCache</span> = {};
        <span class="class">K</span>.<span class="variable">style</span>(<span class="keyword">null</span>, <span class="variable">styleString</span>);
    } 
    (<span class="variable">_els</span> ? (<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">_els</span>) ? <span class="variable">_els</span> : [<span class="variable">_els</span>]) : <span class="variable">els</span>).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">el</span>){
        <span class="keyword">var</span> <span class="variable">s</span> = <span class="class">K</span>.<span class="variable">getStyle</span>(<span class="variable">el</span>, <span class="variable">el</span>.<span class="variable">_type</span>), <span class="variable">p</span>;
        <span class="keyword">for</span>(<span class="variable">p</span> <span class="keyword">in</span> <span class="variable">s</span>){
            <span class="variable">el</span>[<span class="variable">p</span>] = <span class="variable">s</span>[<span class="variable">p</span>];
        }
    });	
};

<span class="class">K</span>.<span class="variable">parseRule</span> = <span class="keyword">function</span>(<span class="variable">prop</span>, <span class="variable">obj</span>){
    <span class="keyword">var</span> <span class="variable">m</span>, <span class="variable">val</span>, <span class="variable">camelized</span>, <span class="variable">obj</span> = <span class="variable">obj</span> || {};
    
    <span class="variable">m</span> = <span class="variable">prop</span>.<span class="variable">value</span>.<span class="variable">match</span>(<span class="variable">rEvalProp</span>);
    <span class="variable">value</span> = <span class="variable">prop</span>.<span class="variable">value</span>;
    <span class="variable">property</span> = <span class="variable">prop</span>.<span class="variable">property</span>.<span class="variable">trim</span>();
    <span class="variable">camelized</span> = <span class="variable">property</span>.<span class="variable">toCamel</span>();
    
    <span class="comment">//Ti.API.log('property', { property: property, hascamel: !!property.toCamel })</span>

    <span class="comment">//Ti.API.log('rule', ['>'+value+'<', '>'+property+'<', m]);</span>

    <span class="keyword">if</span>(<span class="variable">m</span> && <span class="variable">m</span>[<span class="number integer">0</span>]){
        <span class="comment">//Ti.API.log('rule', ['>'+value+'<', '>'+property+'<', eval('('+value.substring((m[1] && m[1].length) || 0)+')')]);</span>
        <span class="variable">obj</span>[<span class="variable">camelized</span>] = <span class="variable">eval</span>(<span class="string">'('</span>+<span class="variable">value</span>.<span class="variable">substring</span>((<span class="variable">m</span>[<span class="number integer">1</span>] && <span class="variable">m</span>[<span class="number integer">1</span>].<span class="variable">length</span>) || <span class="number integer">0</span>)+<span class="string">')'</span>);
    } <span class="keyword">else</span> {
        <span class="keyword">switch</span>((<span class="variable">camelized</span> = <span class="variable">property</span>.<span class="variable">toCamel</span>())){
            <span class="keyword">case</span> <span class="string">'shadowOffsetX'</span>:
                (<span class="variable">obj</span>.<span class="variable">shadowOffset</span> = <span class="variable">obj</span>.<span class="variable">shadowOffset</span> || {}).<span class="variable">x</span> = <span class="variable">parseFloat</span>(<span class="variable">value</span>);
                <span class="keyword">break</span>;
            <span class="keyword">case</span> <span class="string">'shadowOffsetY'</span>:
                (<span class="variable">obj</span>.<span class="variable">shadowOffset</span> = <span class="variable">obj</span>.<span class="variable">shadowOffset</span> || {}).<span class="variable">y</span> = <span class="variable">parseFloat</span>(<span class="variable">value</span>);
                <span class="keyword">break</span>;
            
            <span class="keyword">case</span> <span class="string">'fontFamily'</span>:
            <span class="keyword">case</span> <span class="string">'fontWeight'</span>:
            <span class="keyword">case</span> <span class="string">'fontSize'</span>:
                <span class="variable">obj</span>.<span class="variable">font</span> = <span class="variable">obj</span>.<span class="variable">font</span> || {};
                <span class="variable">obj</span>.<span class="variable">font</span>[<span class="variable">camelized</span>] = <span class="variable">value</span>;
                <span class="keyword">break</span>;
            
            <span class="keyword">case</span> <span class="string">'backgroundGradient'</span>:
                <span class="keyword">var</span> <span class="variable">parts</span> = <span class="variable">value</span>.<span class="variable">match</span>(<span class="regexp">/(\w+)-gradient\((\w+)\s?(\w+)?\s*,\s*(.*)\)/</span>),
                    <span class="variable">gradientType</span> = <span class="variable">parts</span>[<span class="number integer">1</span>],
                    <span class="variable">gradientStartX</span> = <span class="variable">parts</span>[<span class="number integer">2</span>],
                    <span class="variable">gradientStartY</span> = <span class="variable">parts</span>[<span class="number integer">3</span>],
                    <span class="variable">colors</span> = <span class="variable">parts</span>[<span class="number integer">4</span>].<span class="variable">split</span>(<span class="string">","</span>).<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">c</span>){ <span class="keyword">var</span> <span class="variable">p</span> = <span class="variable">c</span>.<span class="variable">match</span>(<span class="regexp">/(\w+)\s+([\d.]+)/</span>); <span class="keyword">return</span> <span class="variable">p</span> && {<span class="variable">color</span>: <span class="string">'#'</span>+<span class="variable">p</span>[<span class="number integer">1</span>], <span class="variable">position</span>: <span class="variable">p</span>[<span class="number integer">2</span>]}; });
                
                    <span class="variable">obj</span>.<span class="variable">backgroundGradient</span> = { <span class="variable">type</span>: <span class="variable">gradientType</span>, <span class="variable">colors</span>:<span class="variable">colors</span> };
                    <span class="comment">//Ti.API.log('grad', JSON.stringify(obj.backgroundGradient));</span>
                    <span class="comment">//Ti.API.log('OBJ', [gradientType, colors]);</span>
                <span class="keyword">break</span>;	
            
            <span class="keyword">default</span>:
                <span class="keyword">if</span>(<span class="variable">camelized</span> == <span class="string">'backgroundImage'</span>){ <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">'info'</span>, <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">value</span>)); }
                <span class="variable">obj</span>[<span class="variable">camelized</span>] = <span class="variable">value</span>;
                <span class="keyword">break</span>; 
        }
    }
    
    <span class="keyword">return</span> <span class="variable">obj</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Parse and apply styles found in specified file or in call
 - <strong>param</strong>: <em>file</em>
 Filename containing styles. Optional
 - <strong>param</strong>: <em>str</em>
 String containing styles. Optional
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">rEvalProp</span> = <span class="regexp">/^(=)?(Ti|Titanium)?/</span>;
<span class="class">K</span>.<span class="variable">style</span> = <span class="keyword">function</span>(<span class="variable">file</span>, <span class="variable">str</span>, <span class="variable">applyStyles</span>){
    <span class="keyword">try</span> {
        <span class="keyword">if</span>(!<span class="variable">str</span>){
            <span class="variable">str</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">getFile</span>(<span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">resourcesDirectory</span>, <span class="variable">file</span>).<span class="variable">read</span>().<span class="variable">text</span>.<span class="variable">toString</span>();
        }
        <span class="keyword">var</span> <span class="variable">selectors</span> = <span class="class">K</span>.<span class="variable">buildSelectorTree</span>(<span class="variable">str</span>), <span class="variable">m</span>, <span class="variable">val</span>, <span class="variable">prop</span>, <span class="variable">camelized</span>;
        (<span class="variable">selectors</span> || []).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">sel</span>){
            <span class="keyword">var</span> <span class="variable">obj</span> = <span class="variable">styles</span>[<span class="variable">sel</span>.<span class="variable">selector</span>] = <span class="variable">styles</span>[<span class="variable">sel</span>.<span class="variable">selector</span>] || {};
            <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">sel</span>.<span class="variable">properties</span>.<span class="variable">length</span>; <span class="variable">i</span> < <span class="variable">len</span>; <span class="variable">i</span>++){
                <span class="class">K</span>.<span class="variable">parseRule</span>(<span class="variable">sel</span>.<span class="variable">properties</span>[<span class="variable">i</span>], <span class="variable">obj</span>);
            }
            <span class="comment">//sel.properties.forEach(K.parseRule);</span>
            
            <span class="keyword">if</span>(<span class="variable">applyStyles</span>){
                <span class="class">K</span>(<span class="variable">sel</span>.<span class="variable">selector</span>).<span class="variable">each</span>(<span class="keyword">function</span>() {
                    <span class="keyword">var</span> <span class="variable">el</span> = <span class="this">this</span>;
                    <span class="keyword">for</span>(<span class="keyword">var</span> <span class="variable">property</span> <span class="keyword">in</span> <span class="variable">obj</span>){
                        <span class="variable">el</span>[<span class="variable">property</span>] = <span class="variable">obj</span>[<span class="variable">property</span>];
                    }
                });
            }
            
        });
    
        <span class="class">K</span>.<span class="variable">refreshStyles</span>(); <span class="comment">// Refresh styles</span>
    } <span class="keyword">catch</span>(<span class="variable">e</span>){ <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">'style apply error'</span>, <span class="variable">e</span>); }
};

<span class="class">K</span>.<span class="variable">loadStyle</span> = <span class="keyword">function</span>(<span class="variable">filename</span>){
    <span class="keyword">var</span> <span class="variable">contents</span>, <span class="variable">tmp</span>, <span class="variable">path</span> = <span class="string">'kss/'</span> + <span class="variable">filename</span> + <span class="string">'.kss'</span>;
    <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'Loading styles for '</span> + <span class="variable">filename</span>);
    <span class="keyword">if</span>( (<span class="variable">contents</span> = <span class="class">K</span>.<span class="variable">file</span>(<span class="string">'res://'</span>+<span class="variable">path</span>)) ){
        <span class="class">K</span>.<span class="variable">style</span>(<span class="keyword">null</span>, <span class="variable">contents</span>);
    }
};

<span class="keyword">function</span> <span class="variable">forEach</span>(<span class="variable">object</span>, <span class="variable">callback</span>, <span class="variable">reverse</span>) {
    <span class="keyword">var</span> <span class="variable">name</span>, <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">value</span>,
        <span class="variable">length</span> = <span class="variable">object</span>.<span class="variable">length</span>,
        <span class="variable">isObj</span> = <span class="variable">length</span> === <span class="class">UNDEFINED</span>;

    <span class="keyword">if</span> (<span class="variable">isObj</span>) {
        <span class="keyword">for</span> (<span class="variable">name</span> <span class="keyword">in</span> <span class="variable">object</span>) {
            <span class="keyword">if</span> (<span class="variable">object</span>.<span class="variable">hasOwnProperty</span>(<span class="variable">name</span>)) {
                <span class="keyword">if</span> (<span class="variable">callback</span>.<span class="variable">call</span>(<span class="variable">object</span>[<span class="variable">name</span>], <span class="variable">name</span>, <span class="variable">object</span>[<span class="variable">name</span>]) === <span class="class">FALSE</span>) {
                    <span class="keyword">break</span>;
                }
            }
        }
    } <span class="keyword">else</span> {
        <span class="keyword">for</span> (<span class="variable">value</span> = <span class="variable">object</span>[<span class="number integer">0</span>]; <span class="variable">i</span> < <span class="variable">length</span> && <span class="variable">callback</span>.<span class="variable">call</span>(<span class="variable">value</span>, <span class="variable">i</span>, <span class="variable">value</span>) !== <span class="class">FALSE</span>; <span class="variable">value</span> = <span class="variable">object</span>[++<span class="variable">i</span>]) {
            <span class="keyword">continue</span>;
        }
    }
}

<span class="comment">// Code from... ?</span>
<span class="keyword">var</span> <span class="class">WHITESPACE_CHARACTERS</span> = <span class="regexp">/\t|\n|\r/g</span>,
    <span class="class">EMPTY_STRING</span> = <span class="string">""</span>,
    <span class="class">PLACEHOLDER_STRING</span> = <span class="string">"$1"</span>,
    <span class="class">END_MUSTACHE</span> = <span class="string">"}"</span>,

    <span class="comment">// Minification optimizations</span>
    <span class="class">TRUE</span> = <span class="variable">true</span>,
    <span class="class">FALSE</span> = <span class="variable">false</span>,
    <span class="class">NULL</span> = <span class="keyword">null</span>,
    <span class="class">UNDEFINED</span> = <span class="variable">undefined</span>;

    <span class="keyword">var</span> <span class="variable">psuedoMatchers</span> = {
        <span class="variable">android</span>: <span class="class">Ti</span>.<span class="class">Platform</span>.<span class="variable">osname</span> === <span class="string">'android'</span>,
        <span class="variable">ios</span>: <span class="class">Ti</span>.<span class="class">Platform</span>.<span class="variable">osname</span> === <span class="string">'iphone'</span>
    };
    <span class="class">K</span>.<span class="variable">buildSelectorTree</span> = <span class="keyword">function</span>(<span class="variable">text</span>) {
        <span class="keyword">var</span> <span class="variable">rules</span> = [], <span class="variable">ruletext</span>, <span class="variable">rule</span>,
            <span class="variable">match</span>, <span class="variable">selector</span>, <span class="variable">psuedo</span>, <span class="variable">pidx</span>, <span class="variable">proptext</span>, <span class="variable">splitprop</span>, <span class="variable">properties</span>, <span class="variable">sidx</span>, <span class="variable">prop</span>, <span class="variable">val</span>;

        <span class="comment">// Tabs, Returns</span>
        <span class="variable">text</span> = <span class="variable">text</span>.<span class="variable">replace</span>(<span class="class">WHITESPACE_CHARACTERS</span>, <span class="class">EMPTY_STRING</span>);
        <span class="comment">// Leading / Trailing Whitespace</span>
        <span class="variable">text</span> = <span class="variable">text</span>.<span class="variable">replace</span>(<span class="regexp">/\s?(\{|\:|\})\s?/g</span>, <span class="class">PLACEHOLDER_STRING</span>);
        <span class="comment">//Ti.API.log('t1', text);</span>
        <span class="variable">ruletext</span> = <span class="variable">text</span>.<span class="variable">split</span>(<span class="class">END_MUSTACHE</span>);
        <span class="comment">//Ti.API.log('t2', ruletext);</span>
        <span class="variable">forEach</span>(<span class="variable">ruletext</span>, <span class="keyword">function</span> (<span class="variable">i</span>, <span class="variable">text</span>) {
            <span class="keyword">if</span> (<span class="variable">text</span>) {
                <span class="variable">rule</span> = [<span class="variable">text</span>, <span class="class">END_MUSTACHE</span>].<span class="variable">join</span>(<span class="class">EMPTY_STRING</span>);
                <span class="variable">match</span> = (<span class="regexp">/(.*)\{(.*)\}/</span>).<span class="variable">exec</span>(<span class="variable">rule</span>);

                <span class="keyword">if</span> (<span class="variable">match</span> && <span class="variable">match</span>.<span class="variable">length</span> && <span class="variable">match</span>[<span class="number integer">2</span>]) {
                    <span class="variable">selector</span> = <span class="variable">match</span>[<span class="number integer">1</span>];

                    <span class="variable">proptext</span> = <span class="variable">match</span>[<span class="number integer">2</span>].<span class="variable">split</span>(<span class="string">";"</span>);
                    <span class="variable">properties</span> = [];

                    <span class="variable">forEach</span>(<span class="variable">proptext</span>, <span class="keyword">function</span> (<span class="variable">i</span>, <span class="variable">x</span>) {
                        <span class="variable">sidx</span> = <span class="variable">x</span>.<span class="variable">indexOf</span>(<span class="string">":"</span>);
                        <span class="variable">prop</span> = <span class="variable">x</span>.<span class="variable">substring</span>(<span class="number integer">0</span>, <span class="variable">sidx</span>).<span class="variable">trim</span>();
                        <span class="variable">val</span> = <span class="variable">x</span>.<span class="variable">substring</span>(<span class="variable">sidx</span>+<span class="number integer">1</span>).<span class="variable">trim</span>();

                        <span class="keyword">if</span> (<span class="variable">prop</span>) {
                            <span class="variable">properties</span>.<span class="variable">push</span>({ <span class="variable">property</span> : <span class="variable">prop</span>, <span class="variable">value</span> : <span class="variable">val</span> });
                        }
                    });


                    <span class="keyword">if</span> (
                        <span class="variable">selector</span> && 
                        <span class="variable">properties</span>.<span class="variable">length</span> && 

                        (<span class="variable">pidx</span> = <span class="variable">selector</span>.<span class="variable">indexOf</span>(<span class="string">":"</span>)) === -<span class="number integer">1</span> ? 
                            <span class="variable">true</span> : 
                            (
                                (<span class="variable">psuedo</span> = <span class="variable">selector</span>.<span class="variable">match</span>(<span class="regexp">/:[^:]+/g</span>)) && 
                                (<span class="variable">selector</span> = <span class="variable">selector</span>.<span class="variable">substring</span>(<span class="number integer">0</span>, <span class="variable">pidx</span>)) && 
                                (<span class="variable">psuedo</span>.<span class="variable">filter</span>(<span class="keyword">function</span>(<span class="variable">p</span>){ 
                                    <span class="keyword">return</span> <span class="variable">psuedoMatchers</span>[<span class="variable">p</span>.<span class="variable">substring</span>(<span class="number integer">1</span>)]; 
                                }).<span class="variable">length</span> === <span class="variable">psuedo</span>.<span class="variable">length</span>)
                            )

                    ) {
                        <span class="variable">rules</span>.<span class="variable">push</span>({ <span class="variable">selector</span> : <span class="variable">selector</span>, <span class="variable">properties</span> : <span class="variable">properties</span> });
                    }
                }
            }
        });

        <span class="keyword">return</span> <span class="variable">rules</span>;
    };

    <span class="class">K</span>.<span class="variable">loadStyle</span>(<span class="string">'app'</span>);

})(<span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/create.js"><a href="#">create</a></h2></td><td>lib/kranium-src/create.js</td></tr><tr class="code">
<td class="docs">
<p>Define create module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Define variables
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">rrep</span> = <span class="regexp">/^(\w)(\w+)/</span>,
    <span class="variable">creators</span> = {};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose creators
 </p>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">creators</span> = <span class="variable">creators</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Default creation function used when subclassing basic element types</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  o</p></li><li><p><strong>returns</strong>: <em>K.UI.Module</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">defaultInit</span>(<span class="variable">o</span>){
    <span class="keyword">var</span> <span class="variable">t</span> = <span class="variable">extend</span>({}, <span class="this">this</span>, { <span class="variable">collection</span>: <span class="variable">false</span> });
    <span class="keyword">var</span> <span class="variable">el</span> = (<span class="variable">creators</span>[<span class="this">this</span>.<span class="variable">type</span>]||<span class="class">K</span>.<span class="variable">create</span>)(<span class="variable">o</span> ? <span class="variable">extend</span>(<span class="variable">t</span>, <span class="variable">o</span>) : <span class="variable">t</span>);
    <span class="variable">el</span>.<span class="variable">_props</span> = <span class="variable">o</span>;
    <span class="keyword">return</span> (<span class="this">this</span>.<span class="variable">el</span> = <span class="variable">el</span>);
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Force Titanium to load basic types
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">forceLoad</span>(){
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">create2DMatrix</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">create3DMatrix</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createActivityIndicator</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createAlertDialog</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createAnimation</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createButton</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createButtonBar</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createCoverFlowView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createDashboardItem</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createDashboardView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createEmailDialog</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createImageView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createLabel</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createMaskedImage</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createOptionDialog</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createPicker</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createPickerColumn</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createPickerRow</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createProgressBar</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createScrollView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createScrollableView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createSearchBar</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createSlider</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createSwitch</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTab</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTabGroup</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTabbedBar</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTableView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTableViewRow</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTableViewSection</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTextArea</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createTextField</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createToolbar</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createWebView</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createWindow</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPad</span>.<span class="variable">createSplitWindow</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPad</span>.<span class="variable">createPopover</span>();
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>.<span class="variable">createNavigationGroup</span>();

    <span class="class">Ti</span>.<span class="class">Map</span>.<span class="variable">createMapView</span>();
    <span class="class">Ti</span>.<span class="class">Map</span>.<span class="variable">createAnnotation</span>();

    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>.<span class="class">SystemButtonStyle</span>.<span class="class">BORDERED</span>;
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>.<span class="class">TableViewStyle</span>.<span class="class">GROUPED</span>;

    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>.<span class="class">TableViewCellSelectionStyle</span>.<span class="class">NONE</span>;
    <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>.<span class="class">ActivityIndicatorStyle</span>.<span class="class">BIG</span>;
}

<span class="keyword">var</span> <span class="variable">defaultCreators</span> = {};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Map some types to easier names too
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">extraCreators</span> = {
    <span class="class">TableViewRow</span>: <span class="string">'Row'</span>,
    <span class="class">TableViewSection</span>: <span class="string">'Section'</span>,
    <span class="class">ImageView</span>: <span class="string">'Image'</span>,
    <span class="class">MapView</span>: <span class="string">'Map'</span>,
    <span class="class">ActivityIndicator</span>: <span class="string">'Indicator'</span>
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Direct type to correct Ti module
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">moduleByType</span> = {
    <span class="variable">splitwindow</span>: <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPad</span>,
    <span class="variable">navigationgroup</span>: <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>,
    <span class="variable">popover</span>: <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPad</span>,
    <span class="variable">mapview</span>: <span class="class">Ti</span>.<span class="class">Map</span>,
    <span class="variable">annotation</span>: <span class="class">Ti</span>.<span class="class">Map</span>
    <span class="comment">// Add media modules</span>
};

<span class="keyword">var</span> <span class="variable">factoryModifier</span> = {
    <span class="variable">mapview</span>: <span class="string">'View'</span>
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Optionally redirect event callbacks
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">function</span> <span class="variable">functionifyEventString</span>(<span class="variable">fn</span>, <span class="variable">to</span>){
    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">fn</span> === <span class="string">'string'</span>) { 
        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="variable">e</span>){
            <span class="keyword">var</span> <span class="variable">value</span> = <span class="variable">e</span>.<span class="variable">value</span>, 
                <span class="variable">s</span> = <span class="variable">e</span>.<span class="variable">source</span>,
                <span class="variable">c</span>;
                
            <span class="keyword">switch</span>(<span class="variable">s</span>&&<span class="variable">s</span>.<span class="variable">_type</span>){
                <span class="keyword">case</span> <span class="string">'tabbedbar'</span>:
                    <span class="variable">value</span> = <span class="variable">s</span>.<span class="variable">labels</span>[<span class="variable">e</span>.<span class="variable">index</span>];
                    <span class="keyword">break</span>;
            }
            <span class="variable">value</span> = (<span class="variable">value</span> && <span class="variable">value</span>.<span class="variable">value</span>)||<span class="variable">value</span>;
            <span class="variable">e</span>.<span class="variable">value</span> = <span class="variable">value</span>;
                            
            <span class="keyword">if</span>(<span class="variable">to</span> && <span class="variable">to</span>[<span class="variable">fn</span>]){
                <span class="variable">to</span>[<span class="variable">fn</span>](<span class="variable">e</span>);
            } <span class="keyword">else</span> {
                (<span class="variable">to</span>||<span class="class">Ti</span>.<span class="class">App</span>).<span class="variable">fireEvent</span>(<span class="variable">fn</span>, <span class="class">K</span>.<span class="variable">extend</span>({ <span class="variable">value</span>: <span class="variable">value</span> }, <span class="variable">e</span>).<span class="variable">sanitize</span>([<span class="string">"type"</span>, <span class="string">"source"</span>]));
            }
        } 
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="variable">fn</span>
    }
}

<span class="keyword">var</span> <span class="variable">extend</span> = <span class="class">K</span>.<span class="variable">extend</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Define creators
 </p>
</td>
<td class="code">
<pre><code>[
    <span class="string">"2DMatrix"</span>, <span class="string">"3DMatrix"</span>, <span class="string">"ActivityIndicator"</span>, <span class="string">"AlertDialog"</span>, <span class="string">"Animation"</span>, 
    <span class="string">"Annotation"</span>, <span class="string">"Button"</span>, <span class="string">"ButtonBar"</span>, <span class="string">"CoverFlowView"</span>, <span class="string">"DashboardItem"</span>, 
    <span class="string">"DashboardView"</span>, <span class="string">"EmailDialog"</span>, <span class="string">"ImageView"</span>, <span class="string">"Label"</span>, <span class="string">"MapView"</span>, 
    <span class="string">"MaskedImage"</span>, <span class="string">"NavigationGroup"</span>, <span class="string">"OptionDialog"</span>, <span class="string">"Picker"</span>, <span class="string">"PickerColumn"</span>, 
    <span class="string">"PickerRow"</span>, <span class="string">"Popover"</span>, <span class="string">"ProgressBar"</span>, <span class="string">"ScrollView"</span>, <span class="string">"ScrollableView"</span>, 
    <span class="string">"SearchBar"</span>, <span class="string">"Slider"</span>, <span class="string">"SplitWindow"</span>, <span class="string">"Switch"</span>, <span class="string">"Tab"</span>, <span class="string">"TabGroup"</span>, 
    <span class="string">"TabbedBar"</span>, <span class="string">"TableView"</span>, <span class="string">"TableViewRow"</span>, <span class="string">"TableViewSection"</span>, <span class="string">"TextArea"</span>, 
    <span class="string">"TextField"</span>, <span class="string">"Toolbar"</span>, <span class="string">"View"</span>, <span class="string">"WebView"</span>, <span class="string">"Window"</span>
]
.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">t</span>){
    <span class="keyword">var</span> <span class="variable">type</span> = <span class="variable">t</span>.<span class="variable">toLowerCase</span>(),
        <span class="variable">module</span> = <span class="variable">moduleByType</span>[<span class="variable">type</span>]||<span class="class">Ti</span>.<span class="class">UI</span>,
        <span class="variable">factoryString</span> = <span class="string">'create'</span> + (<span class="variable">factoryModifier</span>[<span class="variable">type</span>]||<span class="variable">t</span>),
        <span class="variable">extra</span>,
        <span class="variable">_silent</span> = <span class="variable">false</span>;

        <span class="variable">global</span>[<span class="variable">t</span>] = <span class="class">K</span>.<span class="variable">classes</span>[<span class="variable">type</span>] = <span class="class">Class</span>.<span class="variable">extend</span>({
            <span class="variable">type</span>: <span class="variable">type</span>,
            <span class="variable">init</span>: <span class="variable">defaultInit</span>
        });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Expose and define creators
     </p>
</td>
<td class="code">
<pre><code><span class="class">K</span>[<span class="variable">factoryString</span>] = <span class="class">K</span>.<span class="variable">creators</span>[<span class="variable">type</span>] = <span class="keyword">function</span>(<span class="variable">opts</span>){
        <span class="variable">opts</span> = <span class="variable">opts</span>||{};
        <span class="keyword">if</span>(<span class="variable">opts</span>.<span class="variable">_type</span>){ <span class="keyword">return</span> <span class="variable">opts</span>; }
        <span class="keyword">if</span>(<span class="variable">opts</span>.<span class="variable">silent</span> === <span class="variable">true</span>){ <span class="variable">_silent</span> = <span class="variable">true</span>; }
        <span class="keyword">var</span> <span class="variable">o</span> = <span class="variable">extend</span>(<span class="class">K</span>.<span class="variable">getStyle</span>(<span class="variable">opts</span>, <span class="variable">type</span>), <span class="variable">opts</span>), 
            <span class="variable">silent</span> = (<span class="variable">silent</span>||<span class="variable">o</span>.<span class="variable">silent</span>), 
            <span class="variable">children</span>, 
            <span class="variable">cls</span>, 
            <span class="variable">id</span>;

        <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">children</span>){
            <span class="keyword">if</span>(<span class="class">K</span>.<span class="variable">isFunc</span>(<span class="variable">o</span>.<span class="variable">children</span>)){ <span class="variable">children</span> = <span class="variable">o</span>.<span class="variable">children</span>(); } 
            <span class="keyword">else</span> { <span class="variable">children</span> = <span class="variable">o</span>.<span class="variable">children</span>; }
            <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">children</span>;
        }

        <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">id</span>){
            <span class="variable">id</span> = <span class="variable">o</span>.<span class="variable">id</span>;
            <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">id</span>;
        }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle types pre-construct
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">switch</span>(<span class="variable">type</span>){
            <span class="keyword">case</span> <span class="string">'window'</span>:
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">rightNavButton</span>){ <span class="variable">o</span>.<span class="variable">rightNavButton</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">rightNavButton</span>, { <span class="variable">type</span>: <span class="string">'button'</span> }); }
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">leftNavButton</span>){ <span class="variable">o</span>.<span class="variable">leftNavButton</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">leftNavButton</span>, { <span class="variable">type</span>: <span class="string">'button'</span> }); }
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'tableviewrow'</span>:
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">leftImage</span> && <span class="regexp">/^http/</span>.<span class="variable">test</span>(<span class="variable">o</span>.<span class="variable">leftImage</span>)){
                    (<span class="variable">children</span>||[]).<span class="variable">push</span>({ <span class="variable">type</span>: <span class="string">'imageView'</span>, <span class="variable">image</span>: <span class="variable">o</span>.<span class="variable">leftImage</span>, <span class="variable">className</span>: <span class="string">'leftImage'</span> });
                    <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">leftImage</span>;
                }
                <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'tableview'</span>:
                <span class="comment">//o.data = K.create(o.data||[]);</span>
                <span class="variable">o</span>.<span class="variable">data</span> = <span class="variable">o</span>.<span class="variable">data</span> ? <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">data</span>, { <span class="variable">type</span>: <span class="string">'row'</span> }) : [];
                
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">footerView</span>){ <span class="variable">o</span>.<span class="variable">footerView</span> = <span class="class">K</span>.<span class="variable">createView</span>(<span class="variable">o</span>.<span class="variable">footerView</span>); }
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">headerView</span>){ <span class="variable">o</span>.<span class="variable">headerView</span> = <span class="class">K</span>.<span class="variable">createView</span>(<span class="variable">o</span>.<span class="variable">headerView</span>); }
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">search</span>){ <span class="variable">o</span>.<span class="variable">search</span> = <span class="class">K</span>.<span class="variable">createSearchBar</span>(<span class="variable">o</span>.<span class="variable">search</span>); }
                <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'tableviewsection'</span>:
                <span class="keyword">if</span>(<span class="class">K</span>.<span class="variable">isFunc</span>(<span class="variable">o</span>.<span class="variable">rows</span>)){ <span class="variable">o</span>.<span class="variable">rows</span> = <span class="variable">o</span>.<span class="variable">rows</span>(); }
 				<span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">headerTitle</span>){ <span class="variable">o</span>.<span class="variable">headerView</span> = <span class="class">K</span>.<span class="variable">createView</span>({ <span class="variable">className</span>: <span class="string">'headerView'</span>, <span class="variable">children</span>: [{ <span class="variable">type</span>: <span class="string">'label'</span>, <span class="variable">text</span>: <span class="variable">o</span>.<span class="variable">headerTitle</span>, <span class="variable">className</span>: <span class="string">'headerLabel'</span> }, { <span class="variable">type</span>: <span class="string">'view'</span>, <span class="variable">className</span>: <span class="string">'headerBack'</span> }] }); }
                <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">headerTitle</span>;
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">headerPlain</span>){ <span class="variable">o</span>.<span class="variable">headerTitle</span> = <span class="variable">o</span>.<span class="variable">headerPlain</span>; }
                <span class="variable">o</span>.<span class="variable">rows</span> = (<span class="variable">o</span>.<span class="variable">rows</span> || []).<span class="variable">map</span>(<span class="class">K</span>.<span class="variable">createTableViewRow</span>);
                <span class="keyword">if</span>(<span class="class">K</span>.<span class="variable">is</span>.<span class="variable">android</span>){
                    <span class="keyword">var</span> <span class="variable">sectionRows</span> = <span class="variable">o</span>.<span class="variable">rows</span>;
                    <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">rows</span>;
                }
                <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'toolbar'</span>:
                <span class="variable">o</span>.<span class="variable">items</span> = (<span class="variable">o</span>.<span class="variable">items</span> || []).<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">child</span>){
                    <span class="keyword">if</span>(<span class="variable">child</span> === <span class="string">'spacer'</span> || <span class="variable">child</span> === <span class="string">'flexSpace'</span>){ <span class="variable">child</span> = { <span class="variable">systemButton</span>: <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">iPhone</span>.<span class="class">SystemButton</span>.<span class="class">FLEXIBLE_SPACE</span> }; }
                    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">child</span> === <span class="string">'string'</span>){
                        <span class="variable">child</span> = {
                            <span class="variable">type</span>: <span class="variable">child</span>
                        };
                    }
                    
                    <span class="keyword">if</span>(!(<span class="variable">child</span>.<span class="variable">className</span>)){
                        <span class="variable">child</span>.<span class="variable">className</span> = <span class="string">'toolbarButton'</span>;
                    }
                    <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">child</span>, { <span class="variable">type</span>: <span class="string">'button'</span> });
                });
                <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'tab'</span>:
                <span class="variable">o</span>.<span class="variable">window</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">window</span>, { <span class="variable">type</span>: <span class="string">'window'</span> });
                <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'tabgroup'</span>:
                <span class="keyword">if</span>(<span class="class">K</span>.<span class="variable">is</span>.<span class="variable">ios</span>){
                    <span class="variable">o</span>.<span class="variable">tabs</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">tabs</span>, { <span class="variable">type</span>: <span class="string">'tab'</span> });
                } <span class="keyword">else</span> {
                    <span class="variable">o</span>.<span class="variable">_tabs</span> = <span class="variable">o</span>.<span class="variable">tabs</span>;
                    <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">tabs</span>;
                }
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'splitwindow'</span>:
                <span class="variable">o</span>.<span class="variable">masterView</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">masterView</span>, { <span class="variable">type</span>: <span class="string">'navigationgroup'</span> });
                <span class="variable">o</span>.<span class="variable">detailView</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">detailView</span>, { <span class="variable">type</span>: <span class="string">'navigationgroup'</span> });
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'navigationgroup'</span>:
                <span class="variable">o</span>.<span class="variable">window</span> = <span class="class">K</span>.<span class="variable">createWindow</span>(<span class="variable">o</span>.<span class="variable">window</span>);
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'scrollableview'</span>:
                <span class="variable">o</span>.<span class="variable">views</span> = <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">o</span>.<span class="variable">views</span>);
                <span class="keyword">break</span>;
                
        }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Create actual TiObject
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">type</span>;
        <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">o</span>.<span class="variable">intype</span> !== <span class="string">'undefined'</span>){
            <span class="variable">o</span>.<span class="variable">type</span> = <span class="variable">o</span>.<span class="variable">intype</span>;
            <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">intype</span>;
        }
        <span class="keyword">var</span> <span class="variable">el</span> = <span class="variable">module</span>[<span class="variable">factoryString</span>](<span class="variable">o</span>);
        <span class="variable">el</span>.<span class="variable">_uuid</span> = ++<span class="variable">uuid</span>;
        <span class="variable">el</span>.<span class="variable">_type</span> = <span class="variable">type</span>;
        <span class="variable">el</span>.<span class="variable">_opts</span> = <span class="variable">opts</span>;
        <span class="variable">el</span>.<span class="variable">_id</span> = <span class="variable">id</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle types post-construct
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">switch</span>(<span class="variable">type</span>){
            <span class="keyword">case</span> <span class="string">'activityIndicator'</span>:
                <span class="variable">el</span>.<span class="variable">show</span>();
                <span class="keyword">break</span>;

            <span class="keyword">case</span> <span class="string">'tabgroup'</span>:
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">_tabs</span>){ 
                    <span class="variable">o</span>.<span class="variable">_tabs</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">tab</span>){
                        <span class="variable">el</span>.<span class="variable">addTab</span>(<span class="class">K</span>.<span class="variable">createTab</span>(<span class="variable">tab</span>));
                    });
                }
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'picker'</span>:
                (<span class="variable">o</span>.<span class="variable">rows</span>||[]).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">row</span>){

                    <span class="keyword">var</span> <span class="variable">pickerRow</span> = <span class="class">K</span>.<span class="variable">createPickerRow</span>(
                        (<span class="variable">row</span>.<span class="variable">title</span> && <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">row</span>) > <span class="number integer">1</span>) || <span class="variable">el</span>.<span class="variable">addRowClass</span> ?
                        { <span class="variable">_title</span>: <span class="variable">row</span>.<span class="variable">title</span>, <span class="variable">children</span>: [<span class="class">K</span>.<span class="variable">extend</span>({ <span class="variable">type</span>: <span class="string">'label'</span>, <span class="variable">text</span>: <span class="variable">row</span>.<span class="variable">title</span>, <span class="variable">className</span>: <span class="variable">el</span>.<span class="variable">addRowClass</span>, <span class="variable">width</span>: <span class="string">'auto'</span>, <span class="variable">height</span>: <span class="string">'auto'</span> }, <span class="variable">row</span>)] } : 
                        <span class="variable">row</span>
                    );

                    <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">'pr'</span>, { <span class="variable">el</span>: <span class="variable">pickerRow</span>, <span class="variable">children</span>: <span class="variable">pickerRow</span>.<span class="variable">children</span> })

                    <span class="variable">el</span>.<span class="variable">add</span>(
                        <span class="variable">pickerRow</span>
                    );
                });
                <span class="keyword">break</span>;
            
            <span class="keyword">case</span> <span class="string">'tableviewsection'</span>:
                <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'heeeere'</span>);
                <span class="keyword">if</span>(<span class="class">K</span>.<span class="variable">is</span>.<span class="variable">android</span>){
                    <span class="variable">sectionRows</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">row</span>){
                        <span class="class">K</span>.<span class="variable">log</span>([<span class="string">'TRYING TO ADD'</span>, <span class="variable">row</span>, <span class="string">'TO'</span>, <span class="variable">el</span>])
                        <span class="variable">el</span>.<span class="variable">add</span>(<span class="variable">row</span>);
                    });
                }
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'window'</span>:
                <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">loadify</span>){ <span class="class">K</span>.<span class="variable">loadify</span>(<span class="variable">el</span>); }
                <span class="keyword">break</span>;
                
            <span class="keyword">case</span> <span class="string">'textfield'</span>:
            <span class="keyword">case</span> <span class="string">'textarea'</span>:
                <span class="variable">el</span>.<span class="variable">addEventListener</span>(<span class="string">'focus'</span>, <span class="keyword">function</span>(<span class="variable">e</span>){
                    <span class="class">K</span>.<span class="variable">_focusedField</span> = <span class="variable">el</span>;
                });
                <span class="keyword">break</span>;
        }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Add children
         </p>
</td>
<td class="code">
<pre><code>(<span class="variable">children</span> || []).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">child</span>){
            <span class="comment">//child.parentNode = el;</span>
            <span class="variable">el</span>.<span class="variable">add</span>(<span class="class">K</span>.<span class="variable">create</span>(<span class="variable">child</span>));
        });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Cache selectables from el if not silent
         </p>
</td>
<td class="code">
<pre><code><span class="keyword">if</span>(!<span class="variable">_silent</span>){
            <span class="keyword">if</span>((<span class="variable">classes</span> = (<span class="variable">o</span>.<span class="variable">className</span> || <span class="variable">o</span>.<span class="variable">cls</span>))){
                <span class="variable">classes</span>.<span class="variable">split</span>(<span class="regexp">/\s+/</span>).<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">cls</span>){
                    <span class="keyword">if</span>(<span class="variable">cls</span>){
                        (<span class="class">K</span>.<span class="variable">elsByClassName</span>[<span class="variable">cls</span>] = <span class="class">K</span>.<span class="variable">elsByClassName</span>[<span class="variable">cls</span>] || []).<span class="variable">push</span>(<span class="variable">el</span>); 
                    }
                });
            }
            <span class="keyword">if</span>(<span class="variable">id</span>){ <span class="class">K</span>.<span class="variable">elsById</span>[<span class="variable">id</span>] = <span class="variable">el</span>; }
            (<span class="class">K</span>.<span class="variable">elsByName</span>[<span class="variable">type</span>] = <span class="class">K</span>.<span class="variable">elsByName</span>[<span class="variable">type</span>] || []).<span class="variable">push</span>(<span class="variable">el</span>);
            <span class="comment">//els.push(el);</span>
        }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Handle events
         </p>
</td>
<td class="code">
<pre><code><span class="variable">o</span>.<span class="variable">events</span> && (<span class="variable">o</span>.<span class="variable">events</span> = <span class="variable">o</span>.<span class="variable">events</span>.<span class="variable">clone</span>()); <span class="comment">// Hmm... must treat input objects as immutable</span>
        <span class="keyword">if</span>((<span class="variable">fn</span> = <span class="variable">o</span>.<span class="variable">click</span>)){
            (<span class="variable">tmp</span> = (<span class="variable">o</span>.<span class="variable">events</span> = <span class="variable">o</span>.<span class="variable">events</span>||{})).<span class="variable">click</span> ? ((<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">tmp</span>.<span class="variable">click</span>) ? <span class="variable">tmp</span>.<span class="variable">click</span>.<span class="variable">push</span>(<span class="variable">fn</span>) : (<span class="variable">tmp</span>.<span class="variable">click</span> = [<span class="variable">tmp</span>.<span class="variable">click</span>, <span class="variable">fn</span>]) )) : (<span class="variable">tmp</span>.<span class="variable">click</span> = <span class="variable">fn</span>);				
        }
        <span class="keyword">if</span>(<span class="variable">o</span>.<span class="variable">events</span>){
            <span class="keyword">var</span> <span class="variable">scope</span> = <span class="variable">o</span>.<span class="variable">events</span>.<span class="variable">scope</span>||<span class="variable">el</span>, <span class="variable">fn</span>, <span class="variable">name</span>, <span class="variable">toName</span>, <span class="variable">to</span>, <span class="variable">m</span>, <span class="variable">events</span> = {};
            <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">events</span>.<span class="variable">scope</span>;
            <span class="keyword">var</span> <span class="variable">appEvents</span> = <span class="variable">o</span>.<span class="variable">events</span>.<span class="variable">app</span>;
            <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">events</span>.<span class="variable">app</span>;
            
            <span class="keyword">for</span>(<span class="variable">name</span> <span class="keyword">in</span> <span class="variable">o</span>.<span class="variable">events</span>){
                (<span class="variable">events</span>[<span class="variable">name</span>]=<span class="variable">events</span>[<span class="variable">name</span>]||[]).<span class="variable">push</span>({ <span class="variable">fn</span>: <span class="variable">o</span>.<span class="variable">events</span>[<span class="variable">name</span>] });
            }
            <span class="keyword">for</span>(<span class="variable">name</span> <span class="keyword">in</span> <span class="variable">appEvents</span>){
                (<span class="variable">events</span>[<span class="variable">name</span>]=<span class="variable">events</span>[<span class="variable">name</span>]||[]).<span class="variable">push</span>({ <span class="variable">fn</span>: <span class="variable">appEvents</span>[<span class="variable">name</span>], <span class="variable">appEvent</span>: <span class="variable">true</span> });
            }
            <span class="keyword">for</span>(<span class="variable">name</span> <span class="keyword">in</span> <span class="variable">events</span>){
                <span class="variable">events</span>[<span class="variable">name</span>].<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">event</span>){
                    <span class="keyword">var</span> <span class="variable">value</span> = <span class="variable">event</span>.<span class="variable">fn</span>,
                        <span class="variable">bindTo</span> = <span class="variable">event</span>.<span class="variable">appEvent</span> ? <span class="class">Ti</span>.<span class="class">App</span> : <span class="variable">el</span>,
                        <span class="variable">fn</span>;

                    <span class="keyword">if</span>( (<span class="keyword">typeof</span> <span class="variable">value</span> === <span class="string">'string'</span>) ){
                        <span class="keyword">if</span>(<span class="variable">m</span> = <span class="variable">value</span>.<span class="variable">match</span>(<span class="regexp">/^([.#]\S+)\s+(.+)$/</span>)){
                            <span class="variable">toName</span> = <span class="variable">m</span>[<span class="number integer">2</span>];
                            <span class="variable">to</span> = (<span class="variable">tmp</span> = $$(<span class="variable">m</span>[<span class="number integer">1</span>])) && <span class="variable">tmp</span>[<span class="number integer">0</span>]||<span class="variable">tmp</span>;
                        } <span class="keyword">else</span> {
                            <span class="variable">toName</span> = <span class="variable">value</span>;
                            <span class="variable">to</span> = <span class="variable">el</span>;
                        }

                        <span class="variable">fn</span> = <span class="variable">functionifyEventString</span>(<span class="variable">toName</span>, <span class="variable">to</span>);								
                        <span class="variable">bindTo</span>.<span class="variable">addEventListener</span>(<span class="variable">name</span>, <span class="variable">fn</span>);
                    } <span class="keyword">else</span> {
                        <span class="variable">fn</span> = <span class="variable">functionifyEventString</span>(<span class="variable">value</span>);
                        <span class="variable">bindTo</span>.<span class="variable">addEventListener</span>(<span class="variable">name</span>, <span class="variable">scope</span> ? <span class="variable">fn</span>.<span class="variable">bind</span>(<span class="variable">scope</span>) : <span class="variable">fn</span>);
                    }
                });
            }</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>for(name in appEvents){
                fn = functionifyEventString(app[name]);
                Ti.App.addEventListener(name, scope ? fn.bind(scope) : fn);
            }</p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">br</span> = <span class="variable">o</span>.<span class="variable">events</span>.<span class="variable">beforerender</span>;
            <span class="variable">br</span> && ((<span class="keyword">typeof</span> <span class="variable">br</span> === <span class="string">'string'</span>) ? (<span class="variable">el</span>[<span class="variable">br</span>] && <span class="variable">el</span>[<span class="variable">br</span>]({}))||<span class="variable">el</span>.<span class="variable">fireEvent</span>(<span class="variable">br</span>) : <span class="variable">br</span>.<span class="variable">call</span>(<span class="variable">el</span>));
        }

        <span class="keyword">if</span>(<span class="variable">opts</span>.<span class="variable">silent</span> === <span class="variable">true</span>){ <span class="variable">_silent</span> = <span class="variable">false</span>; }
        <span class="keyword">return</span> <span class="variable">el</span>;
    };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Alias extra creators
     </p>
</td>
<td class="code">
<pre><code><span class="keyword">if</span>((<span class="variable">extra</span> = <span class="variable">extraCreators</span>[<span class="variable">t</span>])){
        <span class="keyword">var</span> <span class="variable">extraType</span> = <span class="variable">extra</span>.<span class="variable">toLowerCase</span>();
        <span class="variable">global</span>[<span class="variable">extra</span>] = <span class="class">K</span>.<span class="variable">classes</span>[<span class="variable">extraType</span>] = <span class="class">Class</span>.<span class="variable">extend</span>({
            <span class="variable">type</span>: <span class="variable">type</span>,
            <span class="variable">init</span>: <span class="variable">defaultInit</span>
        });
        
        <span class="class">K</span>[<span class="string">'create'</span> + <span class="variable">extra</span>] = <span class="variable">creators</span>[<span class="variable">extraType</span>] = <span class="variable">creators</span>[<span class="variable">type</span>];
    }
});</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Wrap custom creators with extra logic</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  creator</p></li><li><p><strong>returns</strong>: <em>Function</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">_wrapCustomCreator</span> = <span class="keyword">function</span>(<span class="variable">creator</span>, <span class="variable">type</span>){
    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="variable">o</span>){		
        <span class="keyword">delete</span> <span class="variable">o</span>.<span class="variable">type</span>;
        <span class="keyword">var</span> <span class="variable">obj</span> = (<span class="keyword">new</span> <span class="variable">creator</span>(<span class="variable">o</span>)).<span class="variable">el</span>;

        <span class="keyword">if</span>(!<span class="variable">obj</span>.<span class="variable">_type</span>){
            <span class="variable">obj</span> = <span class="class">K</span>.<span class="variable">creators</span>[(<span class="variable">obj</span>.<span class="variable">type</span>||<span class="string">'view'</span>)](<span class="variable">obj</span>);
        };
        (<span class="class">K</span>.<span class="variable">elsByName</span>[<span class="variable">type</span>]||(<span class="class">K</span>.<span class="variable">elsByName</span>[<span class="variable">type</span>] = [])).<span class="variable">push</span>(<span class="variable">obj</span>);
        <span class="keyword">return</span> <span class="variable">obj</span>;
    }
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Magic element creator. Autoloads custom modules if needed</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  o Element blueprint</p></li><li><p><strong>param</strong>: <em>Object</em>  [def] Default properties to augment each created element with</p></li><li><p><strong>returns</strong>: <em>TiObject |  | Array</em> </p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">create</span> = <span class="keyword">function</span>(<span class="variable">o</span>, <span class="variable">def</span>){
    <span class="keyword">if</span>(<span class="variable">o</span> <span class="variable">instanceof</span> <span class="class">Array</span>){ <span class="keyword">return</span> <span class="variable">o</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">el</span>){ <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">create</span>(<span class="variable">el</span>, <span class="variable">def</span>); }); }
    <span class="keyword">if</span>(<span class="variable">o</span> && <span class="variable">o</span>.<span class="variable">_type</span>){ <span class="keyword">return</span> <span class="variable">o</span>; }
    
    <span class="keyword">var</span> <span class="variable">obj</span>;
    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="variable">o</span> === <span class="string">'string'</span>){
        <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">jade</span>(<span class="variable">o</span>);		
    }
    
    <span class="keyword">if</span>(<span class="variable">def</span> && <span class="keyword">typeof</span> <span class="variable">def</span> === <span class="string">'object'</span>){
        <span class="variable">o</span> = <span class="class">K</span>.<span class="variable">extend</span>({}, <span class="variable">def</span>, <span class="variable">o</span>);
    }

    <span class="keyword">var</span> <span class="variable">type</span> = <span class="variable">o</span>&&<span class="variable">o</span>.<span class="variable">type</span>;

    <span class="keyword">if</span>(!<span class="variable">type</span>){
        <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">'Missing type'</span>, [<span class="variable">o</span>, <span class="variable">type</span>]);
        <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">createLabel</span>({ <span class="variable">text</span>:<span class="string">'mtype'</span> });
    }

    <span class="keyword">if</span>(<span class="variable">type</span> && !<span class="class">K</span>.<span class="variable">creators</span>[<span class="variable">type</span>]){
        <span class="comment">//K.loadStyle(type);</span>

        (<span class="keyword">function</span>(){
            <span class="comment">//Ti.API.log('requiring in creator', type);</span>
            <span class="keyword">var</span> <span class="variable">creator</span> = <span class="class">K</span>.<span class="variable">loadClass</span>(<span class="variable">type</span>)||<span class="keyword">function</span>(){ <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">type</span> + <span class="string">' not available'</span>); };
            <span class="class">K</span>.<span class="variable">classes</span>[<span class="variable">type</span>] = <span class="variable">creator</span>;
            <span class="comment">//obj = (K.creators[type] = wrapCustomCreator(creator, type))(m||o);</span>
            <span class="variable">obj</span> = <span class="class">K</span>.<span class="variable">_wrapCustomCreator</span>(<span class="variable">creator</span>, <span class="variable">type</span>)(<span class="variable">o</span>);
        })();
    } <span class="keyword">else</span> {
        <span class="variable">obj</span> = (<span class="class">K</span>.<span class="variable">creators</span>[<span class="variable">type</span>])(<span class="variable">o</span>);
    }

    <span class="keyword">return</span> <span class="variable">obj</span>.<span class="variable">el</span>||<span class="variable">obj</span>;
};

})(<span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/ajax.js"><a href="#">ajax</a></h2></td><td>lib/kranium-src/ajax.js</td></tr><tr class="code">
<td class="docs">
<p>Define AJAX module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Default AJAX settings
     </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">noop</span> = <span class="keyword">function</span>(){}, 
    <span class="variable">ajaxDefaults</span> = {
    <span class="variable">cache</span>: <span class="variable">true</span>,
    <span class="variable">data</span>: {},
    <span class="variable">error</span>: <span class="keyword">function</span>(){},
    <span class="variable">defError</span>: <span class="keyword">function</span>(<span class="variable">e</span>){
        <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>([<span class="string">'xhr'</span>, <span class="this">this</span>.<span class="variable">opts</span>]);
        <span class="keyword">var</span> <span class="variable">a</span> = <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createAlertDialog</span>({
            <span class="variable">buttonNames</span>: [<span class="string">'Försök igen'</span>,<span class="string">'Avbryt'</span>],
            <span class="variable">cancel</span>: <span class="number integer">1</span>,
            <span class="variable">title</span>: <span class="string">'Kommunikationsfel'</span>,
            <span class="variable">message</span>: <span class="string">"Kunde ej nå server. \nKolla din uppkoppling och försök igen!"</span>
        });
        <span class="keyword">var</span> <span class="variable">xhr</span> = <span class="this">this</span>;
        <span class="variable">a</span>.<span class="variable">addEventListener</span>(<span class="string">'click'</span>, <span class="keyword">function</span>(<span class="variable">e</span>){
            <span class="keyword">if</span>(<span class="variable">e</span>.<span class="variable">index</span> == <span class="number integer">0</span>){
                <span class="class">K</span>.<span class="variable">ajax</span>(<span class="variable">xhr</span>.<span class="variable">inOpts</span>);
            }
        });
        <span class="variable">a</span>.<span class="variable">show</span>();
    },
    <span class="variable">appcacheAge</span>: <span class="number integer">360000000</span>,
    <span class="variable">appcache</span>: <span class="variable">false</span>, <span class="comment">// TODO - set this to false!!</span>
    <span class="variable">timeout</span>: <span class="number integer">30000</span>,
    <span class="variable">success</span>: <span class="variable">noop</span>,
    <span class="variable">type</span>: <span class="string">'GET'</span>,
    <span class="variable">dataType</span>: <span class="string">'json'</span>
    };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Simplified ajax</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  inOpts containing</p><ul><li><p>type</p></li><li>dataType</li><li>data</li><li>success</li><li>error</li><li><p>timeout</p></li></ul></li><li><p><strong>returns</strong>: <em>Ti.Network.HTTPClient</em>  The resulting HTTPClient</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">ajax</span> = <span class="keyword">function</span>(<span class="variable">inOpts</span>){
    <span class="keyword">var</span> <span class="variable">opts</span> = <span class="class">K</span>.<span class="variable">extend</span>(<span class="class">K</span>.<span class="variable">extend</span>({}, <span class="variable">ajaxDefaults</span>), <span class="variable">inOpts</span>), 
        <span class="variable">xhr</span> = <span class="class">Ti</span>.<span class="class">Network</span>.<span class="variable">createHTTPClient</span>(<span class="variable">opts</span>), 
        <span class="variable">data</span> = <span class="class">K</span>.<span class="variable">extend</span>(<span class="variable">opts</span>.<span class="variable">data</span>, <span class="variable">opts</span>.<span class="variable">extendData</span> || {}),
        <span class="variable">loader</span> = { <span class="variable">_hide</span>: <span class="keyword">function</span>(){} },
        <span class="variable">hash</span>;

    <span class="keyword">if</span>(<span class="variable">opts</span>.<span class="variable">loader</span>){
    
        <span class="comment">//Ti.API.log('optsloader', K.stringify(opts.loader));</span>
        <span class="keyword">var</span> <span class="variable">parent</span> = (<span class="variable">opts</span>.<span class="variable">loader</span>.<span class="variable">_type</span> ? <span class="variable">opts</span>.<span class="variable">loader</span> : <span class="class">K</span>.<span class="variable">currentWindow</span>||<span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">currentWindow</span>);
        <span class="variable">loader</span> = <span class="variable">parent</span>.<span class="variable">_loader</span>||<span class="class">K</span>.<span class="variable">createActivityIndicator</span>({ <span class="variable">className</span>: <span class="string">'loader'</span> });
    
        <span class="keyword">if</span>(!<span class="variable">parent</span>.<span class="variable">_loader</span>){
        
            <span class="variable">parent</span>.<span class="variable">add</span>(<span class="variable">loader</span>);
            <span class="variable">loader</span>.<span class="variable">_show</span> = <span class="keyword">function</span>(){ <span class="variable">loader</span>.<span class="variable">opacity</span> = <span class="number integer">0</span>; <span class="variable">loader</span>.<span class="variable">show</span>(); <span class="variable">loader</span>.<span class="variable">animate</span>({ <span class="variable">opacity</span>: <span class="number float">0.7</span>, <span class="variable">duration</span>: <span class="number integer">300</span> }); }
            <span class="variable">loader</span>.<span class="variable">_hide</span> = <span class="keyword">function</span>(){ <span class="variable">loader</span>.<span class="variable">animate</span>({ <span class="variable">opacity</span>: <span class="number integer">0</span>, <span class="variable">duration</span>: <span class="number integer">300</span> }, <span class="keyword">function</span>(){ <span class="variable">loader</span>.<span class="variable">hide</span>(); }); }
            <span class="variable">parent</span>.<span class="variable">_loader</span> = <span class="variable">loader</span>;
        }
        <span class="variable">loader</span>.<span class="variable">_show</span>();
        <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">'showing loader'</span>);
    }
    <span class="variable">xhr</span>.<span class="variable">inOpts</span> = <span class="variable">inOpts</span>;

    <span class="keyword">if</span>(!<span class="variable">opts</span>.<span class="variable">url</span>){
        <span class="variable">loader</span>.<span class="variable">_hide</span>();
        <span class="keyword">return</span> <span class="variable">false</span>;
    }
     
    <span class="variable">xhr</span>.<span class="variable">onload</span> = <span class="keyword">function</span>(){
        <span class="keyword">try</span> {
            <span class="keyword">var</span> <span class="variable">text</span> = <span class="keyword">typeof</span> <span class="variable">opts</span>.<span class="variable">preprocess</span> === <span class="string">'function'</span> ? <span class="variable">opts</span>.<span class="variable">preprocess</span>(<span class="this">this</span>.<span class="variable">responseText</span>) : <span class="this">this</span>.<span class="variable">responseText</span>,
                <span class="variable">response</span>;
                
            <span class="keyword">switch</span> (<span class="variable">opts</span>.<span class="variable">dataType</span>) {
                <span class="keyword">case</span> <span class="string">'json'</span>:
                    <span class="keyword">try</span> {
                        <span class="variable">response</span> = <span class="class">JSON</span>.<span class="variable">parse</span>(<span class="variable">text</span>);
                    }
                    <span class="keyword">catch</span>(<span class="variable">e</span>){
                        <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">e</span>);
                        <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">text</span>);
                        <span class="keyword">throw</span> <span class="string">"WTF?!"</span>+<span class="variable">e</span>;
                    }
                    <span class="keyword">break</span>;
                
                <span class="keyword">default</span>:
                    <span class="variable">response</span> = <span class="variable">text</span>;
                    <span class="keyword">break</span>;
            }

        
            <span class="variable">opts</span>.<span class="variable">success</span> && <span class="variable">opts</span>.<span class="variable">success</span>.<span class="variable">call</span>(<span class="variable">opts</span>.<span class="variable">context</span> || <span class="variable">xhr</span>, <span class="variable">response</span>, <span class="variable">xhr</span>.<span class="variable">status</span>, <span class="variable">xhr</span>);
            <span class="variable">loader</span>.<span class="variable">_hide</span>();
            
            <span class="variable">opts</span>.<span class="variable">complete</span> && <span class="variable">opts</span>.<span class="variable">complete</span>(<span class="variable">xhr</span>, ({<span class="number integer">200</span>:<span class="string">'success'</span>,<span class="number integer">304</span>:<span class="string">'notmodified'</span>})[<span class="variable">xhr</span>.<span class="variable">status</span>]||<span class="string">'error'</span>);
        } 
        <span class="keyword">catch</span> (<span class="variable">e</span>) {
            <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>([<span class="string">'onload error'</span>, <span class="variable">e</span>]);
        }
        <span class="variable">opts</span>.<span class="variable">anyway</span> && <span class="variable">opts</span>.<span class="variable">anyway</span>();
    };
    <span class="variable">xhr</span>.<span class="variable">opts</span> = <span class="variable">opts</span>;
    <span class="keyword">if</span> (!<span class="variable">opts</span>.<span class="variable">silent</span>){
        <span class="variable">xhr</span>.<span class="variable">onerror</span> = <span class="keyword">function</span>(<span class="variable">e</span>){
            <span class="variable">opts</span>.<span class="variable">anyway</span> && <span class="variable">opts</span>.<span class="variable">anyway</span>();
            <span class="variable">loader</span>.<span class="variable">_hide</span>();
            <span class="keyword">if</span>( (<span class="variable">opts</span>.<span class="variable">error</span> && <span class="variable">opts</span>.<span class="variable">error</span>(<span class="variable">e</span>) !== <span class="variable">false</span>) || !<span class="variable">opts</span>.<span class="variable">error</span>){ <span class="variable">xhr</span>.<span class="variable">defError</span>(<span class="variable">e</span>); }
        };
    }
    <span class="variable">xhr</span>.<span class="variable">requestedAt</span> = <span class="keyword">new</span> <span class="class">Date</span>().<span class="variable">getTime</span>();
    <span class="variable">xhr</span>.<span class="variable">open</span>(<span class="variable">opts</span>.<span class="variable">type</span>, <span class="variable">opts</span>.<span class="variable">url</span> + (!<span class="variable">opts</span>.<span class="variable">cache</span> ? <span class="string">'?'</span> + <span class="keyword">new</span> <span class="class">Date</span>().<span class="variable">getTime</span>() : <span class="string">''</span>));

    <span class="variable">opts</span>.<span class="variable">beforeSend</span> && <span class="variable">opts</span>.<span class="variable">beforeSend</span>(<span class="variable">xhr</span>);
    <span class="variable">opts</span>.<span class="variable">contentType</span> && <span class="variable">xhr</span>.<span class="variable">setRequestHeader</span>(<span class="string">'Content-Type'</span>, <span class="variable">opts</span>.<span class="variable">contentType</span>);
    <span class="keyword">var</span> <span class="variable">name</span>;
    <span class="keyword">if</span>(<span class="variable">opts</span>.<span class="variable">headers</span>){
        <span class="keyword">for</span>(<span class="variable">name</span> <span class="keyword">in</span> <span class="variable">opts</span>.<span class="variable">headers</span>){
            <span class="variable">xhr</span>.<span class="variable">setRequestHeader</span>(<span class="variable">name</span>, <span class="variable">opts</span>.<span class="variable">headers</span>[<span class="variable">name</span>]);
        }
    }
    <span class="variable">xhr</span>.<span class="variable">send</span>(<span class="variable">data</span>);
    <span class="keyword">return</span> <span class="variable">xhr</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Change default AJAX settings</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  opts containing any or all of</p><ul><li><p>type</p></li><li>dataType</li><li>data</li><li>success</li><li>error</li><li>timeout</li></ul></li></ul>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">ajaxSetup</span> = <span class="keyword">function</span>(<span class="variable">opts</span>){ <span class="class">K</span>.<span class="variable">merge</span>(<span class="variable">ajaxDefaults</span>, <span class="variable">opts</span>); };</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>YQL service path
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">yqlStart</span> = <span class="string">'http://query.yahooapis.com/v1/public/yql'</span>,
    <span class="variable">yqlEnd</span> = <span class="string">'&format=json&callback='</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>YQL interface</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  opts containing</p><ul><li><p>q</p></li><li>params</li><li>success</li><li>error</li><li><p>timeout</p></li></ul></li><li><p><strong>returns</strong>: <em>Ti.Network.HTTPClient</em>  The resulting HTTPClient</p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">K</span>.<span class="variable">yql</span> = <span class="keyword">function</span>(<span class="variable">opts</span>){
    <span class="variable">opts</span>.<span class="variable">url</span> = <span class="variable">yqlStart</span>;
    <span class="variable">opts</span>.<span class="variable">data</span> = (<span class="string">'format=json&callback=&diagnostics=true&q='</span> + <span class="variable">opts</span>.<span class="variable">q</span>).<span class="variable">esc</span>(<span class="variable">opts</span>.<span class="variable">params</span>, <span class="variable">encodeURIComponent</span>).<span class="variable">toString</span>();
    <span class="variable">opts</span>.<span class="variable">type</span> = <span class="string">'POST'</span>;
    <span class="variable">opts</span>.<span class="variable">headers</span> = {
        <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded; charset=UTF-8"</span>
    };
    <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">ajax</span>(<span class="variable">opts</span>);
};

})(<span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/live.js"><a href="#">live</a></h2></td><td>lib/kranium-src/live.js</td></tr><tr class="code">
<td class="docs">
<p>Define live module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>) {

<span class="class">K</span>.<span class="variable">reset</span> = <span class="keyword">function</span>() {
    <span class="class">K</span>.<span class="variable">elsByClassName</span> = {};
    <span class="class">K</span>.<span class="variable">elsById</span> = {};
    <span class="class">K</span>.<span class="variable">elsByName</span> = {};
    <span class="variable">uuid</span> = <span class="variable">win</span>.<span class="variable">_uuid</span> = <span class="number integer">1</span>;
};
<span class="class">K</span>.<span class="variable">reset</span>();

<span class="keyword">function</span> <span class="variable">cleanse</span>(<span class="variable">s</span>) {
    <span class="keyword">return</span> (<span class="variable">s</span> || <span class="string">''</span>).<span class="variable">replace</span>(<span class="regexp">/[<>&]/g</span>, <span class="keyword">function</span>(<span class="variable">m</span>) {
        <span class="keyword">return</span> {
            <span class="string">'&'</span>: <span class="string">'&amp;'</span>,
            <span class="string">'>'</span>: <span class="string">'&gt;'</span>,
            <span class="string">'<'</span>: <span class="string">'&lt;'</span>
        } [<span class="variable">m</span>];
    });
}

<span class="keyword">var</span> <span class="class">Framer</span> = <span class="keyword">function</span>(<span class="variable">delimiter</span>) {
    <span class="this">this</span>.<span class="variable">delimiter</span> = <span class="variable">delimiter</span> ? <span class="variable">delimiter</span> : <span class="string">"\0"</span>;
    <span class="this">this</span>.<span class="variable">buffer</span> = [];
};

<span class="class">Framer</span>.<span class="variable">prototype</span>.<span class="variable">next</span> = <span class="keyword">function</span>(<span class="variable">data</span>) {
    <span class="keyword">var</span> <span class="variable">frames</span> = <span class="variable">data</span>.<span class="variable">split</span>(<span class="this">this</span>.<span class="variable">delimiter</span>, -<span class="number integer">1</span>);
    <span class="this">this</span>.<span class="variable">buffer</span>.<span class="variable">push</span>(<span class="variable">frames</span>.<span class="variable">shift</span>());
    <span class="keyword">if</span> (<span class="variable">frames</span>.<span class="variable">length</span> > <span class="number integer">0</span>) {
        <span class="variable">frames</span>.<span class="variable">unshift</span>(<span class="this">this</span>.<span class="variable">buffer</span>.<span class="variable">join</span>(<span class="string">''</span>));
        <span class="this">this</span>.<span class="variable">buffer</span>.<span class="variable">length</span> = <span class="number integer">0</span>;
        <span class="this">this</span>.<span class="variable">buffer</span>.<span class="variable">push</span>(<span class="variable">frames</span>.<span class="variable">pop</span>());
    }
    <span class="keyword">return</span> <span class="variable">frames</span>;
};

<span class="keyword">var</span> <span class="variable">framer</span> = <span class="keyword">new</span> <span class="class">Framer</span>(<span class="string">"ZOMG"</span> + <span class="string">"KRAWALLERROCKS"</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Start watching for file changes to be piped from nodejs server
 - <strong>param</strong>: <em>host</em>
 Host for server
 - <strong>param</strong>: <em>port</em>
 Port for server. Default is 8128
 - <strong>param</strong>: <em>win</em>
 Window to add 'close' listener to for cleaning up socket
 </p>
</td>
<td class="code">
<pre><code><span class="class">Ti</span>.<span class="class">App</span>.<span class="class">Properties</span>.<span class="variable">setBool</span>(<span class="string">'_watching'</span>, <span class="variable">false</span>);
<span class="class">K</span>.<span class="variable">watch</span> = <span class="keyword">function</span>(<span class="variable">host</span>, <span class="variable">port</span>) {
    <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'starting livetanium'</span>);
    <span class="comment">// Only open one connection, preferrably from app.js</span>
    <span class="keyword">if</span> (<span class="class">Ti</span>.<span class="class">App</span>.<span class="class">Properties</span>.<span class="variable">getBool</span>(<span class="string">'_watching'</span>)) {
        <span class="keyword">return</span> <span class="variable">false</span>;
    }
    <span class="class">Ti</span>.<span class="class">App</span>.<span class="class">Properties</span>.<span class="variable">setBool</span>(<span class="string">'_watching'</span>, <span class="variable">true</span>);

    <span class="keyword">var</span> <span class="variable">watchers</span> = {},
        <span class="class">Watcher</span> = {
        <span class="variable">watch</span>: <span class="keyword">function</span>(<span class="variable">file</span>, <span class="variable">callback</span>, <span class="variable">e</span>) {
            <span class="keyword">if</span> (!<span class="variable">watchers</span>[<span class="variable">file</span>]) {
                <span class="variable">socket</span>.<span class="variable">write</span>(<span class="class">JSON</span>.<span class="variable">stringify</span>({
                    <span class="variable">action</span>: <span class="string">'watch'</span>,
                    <span class="variable">file</span>: <span class="variable">file</span>
                }));
                <span class="variable">watchers</span>[<span class="variable">file</span>] = <span class="variable">e</span>.<span class="variable">source</span>;
            }
        }
    };

    <span class="keyword">var</span> <span class="variable">socket</span> = <span class="class">Titanium</span>.<span class="class">Network</span>.<span class="variable">createTCPSocket</span>({
        <span class="variable">hostName</span>: <span class="variable">host</span>,
        <span class="variable">port</span>: <span class="variable">port</span>,
        <span class="variable">mode</span>: <span class="class">Titanium</span>.<span class="class">Network</span>.<span class="class">READ_WRITE_MODE</span>
    });

    <span class="keyword">function</span> <span class="variable">parseFrame</span>(<span class="variable">frame</span>) {
        <span class="keyword">try</span> {
            <span class="keyword">var</span> <span class="variable">o</span> = <span class="class">JSON</span>.<span class="variable">parse</span>(<span class="variable">frame</span>);

            <span class="keyword">switch</span> (<span class="variable">o</span>.<span class="variable">action</span>) {
                <span class="keyword">case</span> <span class="string">'cmd'</span>:
                    <span class="keyword">var</span> <span class="variable">res</span>;
                    <span class="keyword">try</span> {
                        <span class="variable">res</span> = <span class="variable">eval</span>(<span class="string">'('</span> + <span class="variable">o</span>.<span class="variable">cmd</span> + <span class="string">')'</span>);
                    } <span class="keyword">catch</span>(<span class="variable">e</span>) {
                        <span class="variable">res</span> = <span class="variable">e</span>;
                    }
                    <span class="variable">socket</span>.<span class="variable">write</span>(<span class="class">JSON</span>.<span class="variable">stringify</span>({
                        <span class="variable">action</span>: <span class="string">'res'</span>,
                        <span class="variable">res</span>: <span class="variable">cleanse</span>(<span class="class">K</span>.<span class="variable">stringify</span>(<span class="variable">res</span>)).<span class="variable">replace</span>(<span class="regexp">/[\u007F-\uFFFF]/g</span>, <span class="keyword">function</span>(<span class="variable">a</span>){ <span class="keyword">return</span> <span class="string">'\\u'</span> + (<span class="string">'0000'</span> + <span class="variable">a</span>.<span class="variable">charCodeAt</span>(<span class="number integer">0</span>).<span class="variable">toString</span>(<span class="number integer">16</span>)).<span class="variable">slice</span>(-<span class="number integer">4</span>) })
                    }));
                    <span class="keyword">break</span>;

                <span class="keyword">case</span> <span class="string">'filechange'</span>:
                    <span class="comment">// Upon filechange, call all applicable listening contexts</span>
                    <span class="class">Ti</span>.<span class="class">App</span>.<span class="variable">fireEvent</span>(<span class="string">'filechange'</span>, { <span class="variable">name</span>: <span class="variable">o</span>.<span class="variable">file</span> });
                    <span class="keyword">try</span> {
                        <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">o</span>.<span class="variable">file</span>.<span class="variable">replace</span>(<span class="regexp">/^\.?\/</span>/, <span class="keyword">function</span>($<span class="number integer">0</span>) {
                            <span class="keyword">return</span> <span class="string">''</span>;
                        }).<span class="variable">replace</span>(<span class="regexp">/\/</span>/<span class="variable">g</span>, <span class="string">'-'</span>),
                            <span class="variable">path</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">tempDirectory</span>.<span class="variable">replace</span>(<span class="regexp">/\/</span>$/, <span class="string">''</span>),
                            <span class="variable">h</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">getFile</span>(<span class="variable">path</span>, <span class="variable">name</span>);

                        <span class="variable">h</span>.<span class="variable">write</span>(<span class="variable">o</span>.<span class="variable">content</span>);
                    } <span class="keyword">catch</span>(<span class="variable">e</span>) {
                        <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">e</span>);
                    }

                    <span class="keyword">var</span> <span class="variable">m</span> = <span class="variable">o</span>.<span class="variable">file</span>.<span class="variable">match</span>(<span class="regexp">/[^.]+$/</span>); <span class="comment">// Get file extension</span>
                    <span class="keyword">switch</span> (<span class="variable">m</span> && <span class="variable">m</span>[<span class="number integer">0</span>]) {
                        <span class="keyword">case</span> <span class="string">'kss'</span>:
                        <span class="keyword">case</span> <span class="string">'jss'</span>:
                            <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'Applying live styles from: "'</span> + <span class="variable">o</span>.<span class="variable">file</span> + <span class="string">'"'</span>);
                            
                            <span class="class">K</span>.<span class="variable">style</span>(<span class="keyword">null</span>, <span class="variable">o</span>.<span class="variable">content</span>, <span class="variable">true</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>var tree = K.buildSelectorTree(o.content);
                            tree.forEach(function(rule) {
                                //Ti.API.log('procel', [rule.selector, K(rule.selector)]);
                                K(rule.selector).each(function() {
                                    var el = this;
                                    //Ti.API.log('el', el); 
                                    rule.properties.forEach(function(o) {
                                        el[o.property] = o.value;
                                    });
                                });
                            });</p>
</td>
<td class="code">
<pre><code><span class="keyword">break</span>;

                        <span class="keyword">case</span> <span class="string">'js'</span>:
                            <span class="keyword">if</span> (<span class="regexp">/kui\/</span>/.<span class="variable">test</span>(<span class="variable">o</span>.<span class="variable">file</span>)) {
                                <span class="keyword">var</span> <span class="variable">req</span> = <span class="variable">eval</span>(<span class="string">'try { var exports = {}; '</span> + <span class="variable">o</span>.<span class="variable">content</span> + <span class="string">'; exports.Class; } catch(e){ Ti.API.error(e); }'</span>),
                                    <span class="variable">type</span>;
                                
                                <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'Trying to live update "'</span>+<span class="variable">o</span>.<span class="variable">file</span>+<span class="string">'". If this explodes, run "kranium watch --nolivejs" instead'</span>)
                                <span class="keyword">if</span> (<span class="variable">req</span> && (<span class="variable">type</span> = (<span class="variable">o</span>.<span class="variable">file</span>.<span class="variable">match</span>(<span class="regexp">/([^\/</span>]+)\.<span class="variable">js</span>$/) || [<span class="variable">false</span>, <span class="variable">false</span>])[<span class="number integer">1</span>])) {
                                    <span class="keyword">var</span> <span class="variable">klass</span> = <span class="class">K</span>.<span class="variable">classes</span>[<span class="variable">type</span>] = <span class="class">K</span>.<span class="variable">loadClass</span>(<span class="variable">type</span>, <span class="variable">req</span>);
                                    <span class="class">K</span>(<span class="string">'.'</span> + <span class="variable">type</span>).<span class="variable">each</span>(<span class="keyword">function</span>() {
                                        <span class="comment">//Ti.API.log('oldprops', this._props);</span>
                                        
                                        <span class="keyword">var</span> <span class="variable">old</span> = <span class="this">this</span>,
                                            <span class="variable">index</span>,
                                            <span class="variable">n</span> = <span class="keyword">new</span> <span class="variable">klass</span>(<span class="variable">old</span>.<span class="variable">_props</span>).<span class="variable">el</span>;

                                        <span class="keyword">if</span> (<span class="variable">n</span>.<span class="variable">_type</span> == <span class="string">'window'</span>) {
                                            <span class="class">K</span>(<span class="variable">old</span>.<span class="variable">children</span>).<span class="variable">each</span>(<span class="keyword">function</span>() {
                                                <span class="class">K</span>(<span class="this">this</span>).<span class="variable">remove</span>();
                                            });</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>if ((index = K.elsByName[old._type].indexOf(old)) != -1) {
                                                K.elsByName[old._type].splice(index, 1);
                                            }</p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> $<span class="variable">old</span> = <span class="class">K</span>(<span class="variable">old</span>);
                                            <span class="class">K</span>(<span class="variable">n</span>.<span class="variable">children</span>).<span class="variable">each</span>(<span class="keyword">function</span>() {
                                                $<span class="variable">old</span>.<span class="variable">append</span>(<span class="this">this</span>);
                                            });
                                            <span class="comment">//Ti.API.log('children', n.children);</span>
                                        } <span class="keyword">else</span> {
                                            <span class="keyword">var</span> <span class="variable">parent</span> = <span class="variable">old</span>.<span class="variable">getParent</span>();
                                            <span class="class">K</span>(<span class="variable">old</span>).<span class="variable">remove</span>();</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>if ((index = K.elsByName[old._type].indexOf(old)) != -1) {
                                                K.elsByName[old._type].splice(index, 1);
                                            }</p>
</td>
<td class="code">
<pre><code><span class="class">K</span>(<span class="variable">parent</span>).<span class="variable">append</span>(<span class="variable">n</span>);
                                        }
                                        <span class="comment">//Ti.API.log('n', n);</span>
                                    });
                                }
                            }
                        <span class="keyword">break</span>;
                    }
                    <span class="keyword">break</span>;

                <span class="keyword">case</span> <span class="string">'files'</span>:
                    <span class="comment">// Write all files to app tmp directory on startup</span>
                    <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">info</span>(<span class="string">'Socket connected - receiving files'</span>);
                    <span class="variable">o</span>.<span class="variable">files</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">f</span>, <span class="variable">i</span>) {
                        <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">f</span>.<span class="variable">name</span>.<span class="variable">replace</span>(<span class="regexp">/\.\/</span>/, <span class="keyword">function</span>($<span class="number integer">0</span>) {
                            <span class="keyword">return</span> <span class="string">''</span>;
                        }).<span class="variable">replace</span>(<span class="regexp">/\/</span>/<span class="variable">g</span>, <span class="string">'-'</span>),
                            <span class="variable">path</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">tempDirectory</span>.<span class="variable">replace</span>(<span class="regexp">/\/</span>$/, <span class="string">''</span>),
                            <span class="variable">h</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">getFile</span>(<span class="variable">path</span>, <span class="variable">name</span>);

                        <span class="variable">h</span>.<span class="variable">write</span>(<span class="variable">f</span>.<span class="variable">content</span>);
                    });
                    <span class="keyword">break</span>;

                <span class="keyword">case</span> <span class="string">'message'</span>:
                    <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">info</span>(<span class="string">'Socket message'</span>, <span class="variable">o</span>.<span class="variable">message</span>);
                    <span class="keyword">break</span>;
            }
        } <span class="keyword">catch</span>(<span class="variable">e</span>) {
            <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">e</span>);
        }
    }

    <span class="variable">socket</span>.<span class="variable">addEventListener</span>(<span class="string">'read'</span>, <span class="keyword">function</span>(<span class="variable">e</span>) {
        <span class="comment">//Ti.API.log('inserting into frame', e.data.text);</span>
        <span class="variable">framer</span>.<span class="variable">next</span>(<span class="variable">e</span>.<span class="variable">data</span>.<span class="variable">text</span>).<span class="variable">forEach</span>(<span class="variable">parseFrame</span>);
    });
    
    <span class="variable">socket</span>.<span class="variable">addEventListener</span>(<span class="string">'close'</span>, <span class="keyword">function</span>(<span class="variable">e</span>) {
        <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'socket closed'</span>);
    });

    <span class="class">Ti</span>.<span class="class">App</span>.<span class="variable">addEventListener</span>(<span class="string">'close'</span>, <span class="keyword">function</span>(<span class="variable">e</span>) {
        <span class="keyword">if</span> (<span class="variable">socket</span>.<span class="variable">isValid</span>) {
            <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">log</span>(<span class="string">'close socket'</span>);
            <span class="variable">socket</span>.<span class="variable">close</span>();
        }
    });

    <span class="variable">socket</span>.<span class="variable">connect</span>();
    <span class="variable">socket</span>.<span class="variable">write</span>(<span class="class">JSON</span>.<span class="variable">stringify</span>({
        <span class="variable">action</span>: <span class="string">'echo'</span>,
        <span class="variable">message</span>: <span class="string">'Socket connected'</span>
    }));
    
    <span class="variable">global</span>.<span class="variable">socketwrite</span> = <span class="keyword">function</span>(<span class="variable">msg</span>, <span class="variable">type</span>){ <span class="variable">socket</span>.<span class="variable">write</span>(<span class="class">JSON</span>.<span class="variable">stringify</span>({ <span class="variable">action</span>: <span class="variable">type</span>, <span class="variable">msg</span>: <span class="variable">msg</span> })); };
    <span class="variable">global</span>.<span class="variable">customsocketwrite</span> = <span class="keyword">function</span>(<span class="variable">o</span>){ <span class="keyword">if</span>(!<span class="variable">o</span>.<span class="variable">action</span>){ <span class="keyword">return</span>; } <span class="variable">socket</span>.<span class="variable">write</span>(<span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">o</span>)); };
    
    <span class="keyword">var</span> <span class="variable">log</span> = <span class="class">K</span>.<span class="variable">log</span>;
    <span class="class">K</span>.<span class="variable">log</span> = <span class="keyword">function</span>(){
        <span class="keyword">var</span> <span class="variable">args</span> = <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>);
        <span class="variable">log</span>.<span class="variable">apply</span>(<span class="variable">log</span>, <span class="variable">args</span>);
        <span class="keyword">try</span> {
            <span class="variable">socket</span>.<span class="variable">write</span>(<span class="class">JSON</span>.<span class="variable">stringify</span>({
                <span class="variable">action</span>: <span class="string">'res'</span>,
                <span class="variable">res</span>: <span class="variable">cleanse</span>(<span class="class">K</span>.<span class="variable">stringify</span>(<span class="variable">args</span>.<span class="variable">length</span> === <span class="number integer">1</span> ? <span class="variable">args</span>[<span class="number integer">0</span>] : <span class="variable">args</span>))
            }));
        } <span class="keyword">catch</span>(<span class="variable">e</span>){ <span class="class">Ti</span>.<span class="class">API</span>.<span class="variable">error</span>(<span class="variable">e</span>); }
    };
};

})(<span class="this">this</span>);
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/stringify.js"><a href="#">stringify</a></h2></td><td>lib/kranium-src/stringify.js</td></tr><tr class="code">
<td class="docs">
<p>Define stringify module</p>

<p>TiObject stringifier based heavily on code from @rem's JSConsole
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){
<span class="keyword">var</span> <span class="variable">reTiObject</span> = <span class="regexp">/^\[object Ti/</span>;
<span class="keyword">function</span> <span class="variable">sortci</span>(<span class="variable">a</span>, <span class="variable">b</span>) {
  <span class="keyword">return</span> <span class="variable">a</span>.<span class="variable">toLowerCase</span>() < <span class="variable">b</span>.<span class="variable">toLowerCase</span>() ? -<span class="number integer">1</span> : <span class="number integer">1</span>;
}

<span class="keyword">function</span> <span class="variable">stringify</span>(<span class="variable">o</span>, <span class="variable">simple</span>) {
  <span class="keyword">var</span> <span class="variable">json</span> = <span class="string">''</span>, <span class="variable">i</span>, <span class="variable">type</span> = ({}).<span class="variable">toString</span>.<span class="variable">call</span>(<span class="variable">o</span>), <span class="variable">parts</span> = [], <span class="variable">names</span> = [], <span class="variable">ownType</span> = <span class="variable">o</span> && <span class="variable">o</span>.<span class="variable">toString</span> && <span class="variable">o</span>.<span class="variable">toString</span>();
  
  <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'[object String]'</span>) {
    <span class="variable">json</span> = <span class="string">'"'</span> + <span class="variable">o</span>.<span class="variable">replace</span>(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>) + <span class="string">'"'</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'[object Array]'</span>) {
    <span class="variable">json</span> = <span class="string">'['</span>;
    <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> < <span class="variable">o</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
      <span class="variable">parts</span>.<span class="variable">push</span>(<span class="variable">stringify</span>(<span class="variable">o</span>[<span class="variable">i</span>], <span class="variable">simple</span>));
    }
    <span class="variable">json</span> += <span class="variable">parts</span>.<span class="variable">join</span>(<span class="string">', '</span>) + <span class="string">']'</span>;
    <span class="variable">json</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">o</span> === <span class="keyword">null</span>) {
    <span class="variable">json</span> = <span class="string">'null'</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">o</span> === <span class="variable">undefined</span>) {
    <span class="variable">json</span> = <span class="string">'undefined'</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">ownType</span> && <span class="variable">reTiObject</span>.<span class="variable">test</span>(<span class="variable">ownType</span>)) {
    <span class="variable">json</span> += [
        <span class="string">'"'</span>,
        <span class="string">"<"</span>,
        (<span class="variable">o</span>.<span class="variable">_type</span>||<span class="string">'unknown'</span>),
        (<span class="variable">o</span>.<span class="variable">_id</span> ? <span class="string">" id='"</span>+<span class="variable">o</span>.<span class="variable">_id</span>+<span class="string">"'"</span> : <span class="string">""</span>),
        <span class="variable">o</span>.<span class="variable">className</span> ? <span class="string">" class='"</span>+<span class="variable">o</span>.<span class="variable">className</span>+<span class="string">"'"</span> : <span class="string">""</span>,
        <span class="string">">"</span>,
        ((<span class="variable">tmp</span> = (<span class="variable">o</span>.<span class="variable">text</span>||<span class="variable">o</span>.<span class="variable">title</span>||<span class="string">""</span>))? <span class="variable">tmp</span> :<span class="string">''</span>),
        <span class="string">"</"</span> + (<span class="variable">o</span>.<span class="variable">_type</span>||<span class="string">'unknown'</span>) + <span class="string">">"</span>,
        <span class="string">'"'</span>
    ].<span class="variable">join</span>(<span class="string">""</span>);
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'[object Object]'</span>) {
    <span class="variable">json</span> = <span class="string">'{'</span>;
    <span class="keyword">for</span> (<span class="variable">i</span> <span class="keyword">in</span> <span class="variable">o</span>) {
      <span class="variable">names</span>.<span class="variable">push</span>(<span class="variable">i</span>);
    }
    <span class="variable">names</span>.<span class="variable">sort</span>(<span class="variable">sortci</span>);
    <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> < <span class="variable">names</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
      <span class="variable">parts</span>.<span class="variable">push</span>(<span class="variable">stringify</span>(<span class="variable">names</span>[<span class="variable">i</span>]) + <span class="string">': '</span> + <span class="variable">stringify</span>(<span class="variable">o</span>[<span class="variable">names</span>[<span class="variable">i</span>] ], <span class="variable">simple</span>));
    }
    <span class="variable">json</span> += <span class="variable">parts</span>.<span class="variable">join</span>(<span class="string">', '</span>) + <span class="string">'}'</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'[object Number]'</span>) {
    <span class="variable">json</span> = <span class="variable">o</span>+<span class="string">''</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'[object Boolean]'</span>) {
    <span class="variable">json</span> = <span class="variable">o</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>;
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span> == <span class="string">'[object Function]'</span>) {
    <span class="variable">json</span> = <span class="variable">o</span>.<span class="variable">toString</span>();
  } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">simple</span> == <span class="variable">undefined</span>) {
    <span class="variable">json</span> = <span class="variable">type</span> + <span class="string">'{\n'</span>;
    <span class="keyword">for</span> (<span class="variable">i</span> <span class="keyword">in</span> <span class="variable">o</span>) {
      <span class="variable">names</span>.<span class="variable">push</span>(<span class="variable">i</span>);
    }
    <span class="variable">names</span>.<span class="variable">sort</span>(<span class="variable">sortci</span>);
    <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> < <span class="variable">names</span>.<span class="variable">length</span>; <span class="variable">i</span>++) {
      <span class="variable">parts</span>.<span class="variable">push</span>(<span class="variable">names</span>[<span class="variable">i</span>] + <span class="string">': '</span> + <span class="variable">stringify</span>(<span class="variable">o</span>[<span class="variable">names</span>[<span class="variable">i</span>]], <span class="variable">true</span>)); <span class="comment">// safety from max stack</span>
    }
    <span class="variable">json</span> += <span class="variable">parts</span>.<span class="variable">join</span>(<span class="string">',\n'</span>) + <span class="string">'\n}'</span>;
  } <span class="keyword">else</span> {
    <span class="keyword">try</span> {
      <span class="variable">json</span> = <span class="variable">o</span>+<span class="string">''</span>; <span class="comment">// should look like an object      </span>
    } <span class="keyword">catch</span> (<span class="variable">e</span>) {}
  }
  <span class="keyword">return</span> <span class="variable">json</span>;
}
<span class="class">K</span>.<span class="variable">stringify</span> = <span class="variable">stringify</span>;

})(<span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/end.js"><a href="#">end</a></h2></td><td>lib/kranium-src/end.js</td></tr><tr class="code">
<td class="docs">
<p>Define end module
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){
<span class="class">Ti</span>.<span class="variable">include</span>(<span class="string">'/kranium/kranium-generated-bootstrap.js'</span>);
})(<span class="this">this</span>);
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/tester.js"><a href="#">tester</a></h2></td><td>lib/kranium-src/tester.js</td></tr><tr class="code">
<td class="docs">
<p>Define tester module
Jasmine tester
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(<span class="variable">global</span>){
<span class="keyword">if</span>(<span class="variable">global</span>.<span class="class">TEST</span>){
    <span class="class">K</span>.<span class="variable">log</span>(<span class="string">'Testing activated! :-O'</span>);
    <span class="class">Ti</span>.<span class="class">App</span>.<span class="variable">addEventListener</span>(<span class="string">'filechange'</span>, <span class="variable">test</span>);

    <span class="class">Ti</span>.<span class="variable">include</span>(<span class="string">'/kranium/lib/test/jasmine-1.0.2.js'</span>);
    <span class="class">Ti</span>.<span class="variable">include</span>(<span class="string">'/kranium/lib/test/jasmine-titanium-node.js'</span>);

    <span class="keyword">function</span> <span class="variable">test</span>(){
        <span class="variable">jasmine</span>.<span class="variable">currentEnv_</span> = <span class="keyword">null</span>;
        <span class="variable">jasmine</span>.<span class="variable">getEnv</span>().<span class="variable">addReporter</span>(<span class="keyword">new</span> <span class="variable">jasmine</span>.<span class="class">TitaniumNodeReporter</span>());

        <span class="variable">win</span> = <span class="class">Ti</span>.<span class="class">UI</span>.<span class="variable">createWindow</span>({ <span class="variable">width</span>: <span class="number integer">100</span>, <span class="variable">height</span>: <span class="number integer">100</span>, <span class="variable">backgroundColor</span>: <span class="string">'#ccc'</span>, <span class="variable">left</span>: -<span class="number integer">200</span>, <span class="variable">opacity</span>: <span class="number float">0.8</span> });
        <span class="variable">win</span>.<span class="variable">open</span>();
        <span class="class">Ti</span>.<span class="class">App</span>.<span class="variable">addEventListener</span>(<span class="string">'filechange'</span>, <span class="keyword">function</span>(){ <span class="variable">win</span>.<span class="variable">close</span>(); });

        <span class="variable">q</span> = <span class="keyword">function</span>(<span class="variable">str</span>){
            <span class="keyword">return</span> (<span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>).<span class="variable">join</span>(<span class="string">", "</span>)).<span class="variable">split</span>(<span class="regexp">/\s+,\s+/g</span>).<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">id</span>){ <span class="keyword">return</span> <span class="variable">getElementById</span>(<span class="variable">id</span>); });
        };

        <span class="comment">// Include all the test files</span>
        <span class="comment">//Ti.include('/test/demo.js');</span>
        
        <span class="keyword">var</span> <span class="variable">testDir</span> = <span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">getFile</span>(<span class="class">Ti</span>.<span class="class">Filesystem</span>.<span class="variable">resourcesDirectory</span>, <span class="string">'test'</span>);
        <span class="variable">testDir</span>.<span class="variable">getDirectoryListing</span>().<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">file</span>){
            <span class="keyword">if</span>(<span class="variable">file</span> !== <span class="string">'lib'</span>){
                <span class="class">Ti</span>.<span class="variable">include</span>(<span class="string">'/test/'</span> + <span class="variable">file</span>);
            }
        });
        
        
        <span class="variable">jasmine</span>.<span class="variable">getEnv</span>().<span class="variable">execute</span>();
    }
    <span class="variable">test</span>();
}
})(<span class="this">this</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/kranium-src/jade-loader.js"><a href="#">jade-loader</a></h2></td><td>lib/kranium-src/jade-loader.js</td></tr><tr class="code">
<td class="docs">
<p>Define Jade loader
Only load Jade when needed, and then only do it once.
 </p>
</td>
<td class="code">
<pre><code>(<span class="keyword">function</span>(){
<span class="class">K</span>.<span class="variable">jade</span> = <span class="keyword">function</span>(<span class="variable">jadeStr</span>, <span class="variable">o</span>){
    <span class="class">Ti</span>.<span class="variable">include</span>(<span class="string">'/kranium/lib/kranium-jade.js'</span>);
    <span class="keyword">if</span>(<span class="class">K</span>.<span class="variable">jade</span>.<span class="variable">isLoader</span>){
        <span class="keyword">throw</span> <span class="string">'something went wrong while loading jade'</span>;
    }
    <span class="keyword">return</span> <span class="class">K</span>.<span class="variable">jade</span>(<span class="variable">jadeStr</span>, <span class="variable">o</span>);
};
<span class="class">K</span>.<span class="variable">jade</span>.<span class="variable">isLoader</span> = <span class="variable">true</span>;
})();</code></pre>
</td>
</tr>	</body>
</html></tbody></table>